!function(t,r,a){var n,o=rtGlobalObj.authApi.facebookAppId,i=rtGlobalObj.authApi.togoClientId,s=t.getElementsByTagName(r)[0];t.getElementById("rtrvjs")||((n=t.createElement(r)).id="rtrvjs",n.setAttribute("data-ot-ignore",""),n.src=rtGlobalObj.authApi.rtrvHostUrl,n.async=!0,e=[],window.RTRV={onLoad:function(t){e.push(t)},e:e,facebookAppId:o,togoClientId:i},s.parentNode.insertBefore(n,s))}(document,"script");var rtrv,proUser=rtGlobalObj.authApi.proUserIdent,regUser=rtGlobalObj.authApi.regUserIdent,cookieName="wpe-us",ranOnce=!1;function addPreloader(e){let t=e.innerHTML;return e.innerHTML='<span class="lds-spinner"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span>',t}function removePreloader(e,t){e.innerHTML=t}function showMessage(e,t){let r=e.closest(".popup__window").querySelector(".popup__error-message"),a=e.closest(".popup__window").querySelector("form");r.innerHTML=t,r.style.display="block",a.classList.add("error")}function removeMessage(e){let t=e.closest(".popup__window").querySelector(".popup__error-message"),r=e.closest(".popup__window").querySelector("form");t.innerHTML="",t.style.display="none",r.classList.remove("error")}function clearAllSignupErrors(){let e=document.querySelectorAll(".popup__field-wrapper"),t=document.querySelectorAll(".popup__signup-error-message");for(var r=0;r<e.length;r++)e[r].classList.remove("error");for(r=0;r<t.length;r++)t[r].innerHTML=""}function clearSignupError(){let e=this.closest(".popup__field-wrapper"),t=e.querySelector(".popup__signup-error-message");e.classList.remove("error"),t.innerHTML=""}function signUpError(e,t){let r=document.getElementById(e),a=r.querySelector(".popup__signup-error-message");r.classList.add("error"),a.innerHTML=t}function setCookie(e,t,r,a=null){let n="";{let e=new Date;e.setTime(e.getTime()+31536e6),n=";expires="+e.toUTCString()}document.cookie=e+"="+t+n+";path=/",r&&null==a?window.location.reload():null!==a&&window.location.replace(window.location.href+"?"+a)}function getCookie(e){let t=e+"=",r=document.cookie.split(";");for(let e=0;e<r.length;e++){let a=r[e];for(;" "==a.charAt(0);)a=a.substring(1,a.length);if(0==a.indexOf(t))return a.substring(t.length,a.length)}return null}function deleteCookie(e,t){document.cookie=e+"=;expires=Thu, 01 Jan 1970 00:00:01 GMT;path=/",t&&window.location.reload()}function show_roadpass_modal(e){document.body.classList.add("overflowed"),document.querySelector("html").classList.add("overflowed"),document.querySelector(".popup").classList.remove("popup_visible"),document.querySelector("#main-nav").classList.remove("main-nav_visible"),document.getElementById(e).classList.contains("rp-modal")?(document.querySelector("#overlay").classList.remove("overlay_visible"),document.getElementById(e).classList.add("rp-modal-open")):(document.querySelector("#overlay").classList.add("overlay_visible"),document.getElementById(e).classList.add("popup_visible"))}RTRV.onLoad((function(){if(0==ranOnce){ranOnce=!0;let l=rtGlobalObj.rtApi.hostUrl;var e;switch(l){case"roadtrippers.com":e={host:"https://api2."+l};break;default:e={host:"https://api2."+l,httpBasicAuth:{password:rtGlobalObj.authApi.stageAuthP,userId:rtGlobalObj.authApi.stageAuthU}}}rtrv=new RTRV(e);for(var t=document.querySelectorAll(".popup-opener"),r=document.querySelectorAll(".authorize-with-roadpass"),a=document.querySelectorAll(".rtauth-logout"),n=document.getElementById("fb-email"),o=document.querySelectorAll(".popup__input"),i=0;i<o.length;i++)o[i].addEventListener("focus",(function(e){removeMessage(this)}));document.getElementById("signup-username").addEventListener("input",clearSignupError),document.getElementById("signup-email").addEventListener("input",clearSignupError),document.getElementById("signup-password").addEventListener("input",clearSignupError),rtrv.getUser().then((function(e){rtGlobalObj.user.data=e,rtGlobalObj.user.type="regular",window.dataLayer=window.dataLayer||[],e.email&&window.dataLayer.push({email:e.email,event:"user"}),e.stripe_id&&window.dataLayer.push({stripe_id:e.stripe_id,event:"user"}),e.is_pro&&(rtGlobalObj.tracking.properties.membership_level="roadtrippers plus",rtGlobalObj.user.type="plus"),function(){if(t)for(let e=0;e<t.length;e++)t[e].classList.add("rtauth-hidden");if(r)for(let e=0;e<r.length;e++)r[e].classList.add("rtauth-hidden");if(a)for(let e=0;e<a.length;e++)a[e].classList.remove("rtauth-hidden")}();let n='<img src="'+e.image_v_50x50_url+'" />';e.username&&(n='<a href="https://maps.'+l+"/people/"+e.username+'" target="_blank">'+n+"</a>");let o=document.querySelector(".rt-user-img");o&&(o.innerHTML=n,o.classList.remove("rtauth-hidden")),e.is_pro?setCookie(cookieName,proUser,!1):setCookie(cookieName,regUser,!1),rtrv.isUserRVer({}).then((function(e){rtGlobalObj.user.data.RVer=e;let t=new Event("userReady");document.dispatchEvent(t)}),(function(){rtGlobalObj.user.data.RVer=!1,console.log("error getting RV status");let e=new Event("userReady");document.dispatchEvent(e)}))}),(function(){!function(){if(a)for(let e=0;e<a.length;e++)a[e].classList.add("rtauth-hidden");if(t)for(let e=0;e<t.length;e++)t[e].classList.remove("rtauth-hidden");if(r)for(let e=0;e<r.length;e++)r[e].classList.remove("rtauth-hidden")}(),deleteCookie(cookieName,!1),rtrv.isUserRVer({}).then((function(e){rtGlobalObj.user.data.RVer=e;let t=new Event("userReady");document.dispatchEvent(t)}),(function(){rtGlobalObj.user.data.RVer=!1,console.log("error getting RV status");let e=new Event("userReady");document.dispatchEvent(e)}))}));let d=document.getElementById("register-with-password");d.addEventListener("submit",(function(e){e.stopPropagation(),e.preventDefault(),clearAllSignupErrors();let t=Object.assign({},rtGlobalObj.tracking.properties);t.context="sign up",t.authenticated_by="roadtrippers",analytics.track("Authentication Initiated",t,{},(function(){let t=d.querySelector(".popup__submit"),r=addPreloader(t),a=!1;1==document.getElementById("signup-optin").checked&&(a=!0);let n={email:document.getElementById("signup-email").value,password:document.getElementById("signup-password").value,username:document.getElementById("signup-username").value,marketingEmailsOptIn:a,token:e.detail};rtrv.registerWithPassword(n).then((function(e){clearAllSignupErrors(),rtGlobalObj.user.data=e,e.is_pro&&(rtGlobalObj.tracking.properties.membership_level="roadtrippers plus");let t=Object.assign({},rtGlobalObj.tracking.properties);t.authenticated_by="roadtrippers",analytics.alias(e.id),analytics.identify(e.id,{id:e.id,username:e.username,email:e.email,name:e.name},(function(){analytics.track("User Signed Up",t,{},(function(){rtGlobalObj.user.data.is_pro?setCookie(cookieName,proUser,!0):setCookie(cookieName,regUser,!0)}))}))}),(function(e){removePreloader(t,r);let a=[],n=!1;if(e.errors&&void 0!==e.errors.email&&e.errors.email.length>0&&(a.push(e.errors.email[0]),signUpError("signup-email-wrapper",e.errors.email[0]),n=!0),e.errors&&void 0!==e.errors.username&&e.errors.username.length>0&&(a.push(e.errors.username[0]),signUpError("signup-username-wrapper",e.errors.username[0]),n=!0),e.errors&&void 0!==e.errors.password&&e.errors.password.length>0&&(a.push(e.errors.password[0]),signUpError("signup-password-wrapper",e.errors.password[0]),n=!0),0===a.length?a.push("Invalid username, email, or password"):a.push("An unknown error has occurred. Please try again."),0==n){removePreloader(t,r);showMessage(t,a[0])}t.closest(".popup__window").querySelector(".popup__close").addEventListener("click",(function(e){clearAllSignupErrors(),removeMessage(t)}))}))}))}));let c=document.getElementById("authorize-with-password");c.addEventListener("submit",(function(e){e.preventDefault();let t=c.querySelector(".popup__submit"),r=addPreloader(t),a={login:document.getElementById("login-username").value,password:document.getElementById("login-password").value,token:e.detail};let n=Object.assign({},rtGlobalObj.tracking.properties);n.context="log in",n.authenticated_by="roadtrippers",analytics.track("Authentication Initiated",n,{},(function(){rtrv.authorizeWithPassword(a).then((function(e){rtGlobalObj.user.data=e,e.is_pro&&(rtGlobalObj.tracking.properties.membership_level="roadtrippers plus");let t=Object.assign({},rtGlobalObj.tracking.properties);t.authenticated_by="roadtrippers",analytics.identify(e.id,{id:e.id.toString(),username:e.username,email:e.email,name:e.name},(function(){analytics.track("User Signed In",t,{},(function(){rtGlobalObj.user.data.is_pro?setCookie(cookieName,proUser,!0):setCookie(cookieName,regUser,!0)}))}))}),(function(e){removePreloader(t,r);showMessage(t,"Invalid username or email and password");t.closest(".popup__window").querySelector(".popup__close").addEventListener("click",(function(e){removeMessage(t)}))}))}))}));let u=document.getElementsByClassName("authorize-with-fb");for(let e=0;e<u.length;e++)u[e].addEventListener("click",(function(e){e.preventDefault();var t=this;let r=addPreloader(t),a={},n=Object.assign({},rtGlobalObj.tracking.properties);var o=t.dataset.context;n.context=o,n.authenticated_by="facebook",analytics.track("Authentication Initiated",n,{},(function(){rtrv.authorizeWithFB(a).then((function(e){rtGlobalObj.user.data=e,e.is_pro&&(rtGlobalObj.tracking.properties.membership_level="roadtrippers plus");let t=Object.assign({},rtGlobalObj.tracking.properties);t.authenticated_by="facebook";let r="User Signed In";e.new_user&&(r="User Signed Up",analytics.alias(e.id)),analytics.identify(e.id,{id:e.id.toString(),username:e.username,email:e.email,name:e.name},(function(){analytics.track(r,t,{},(function(){rtGlobalObj.user.data.is_pro?setCookie(cookieName,proUser,!0):e.new_user?setCookie(cookieName,regUser,!0,"eoi"):setCookie(cookieName,regUser,!0)}))}))}),(function(e){e.missing_email?s():e.togo_only?show_roadpass_modal("fb-roadpass-error"):e.errors&&console.log(e.errors),removePreloader(t,r),t.closest(".popup__window").querySelector(".popup__close").addEventListener("click",(function(e){removeMessage(t)}))}))}))}));function s(){document.querySelector(".popup").classList.remove("popup_visible"),document.getElementById("overlay").classList.add("overlay_visible"),n.classList.add("popup_visible")}n.querySelector(".prompt-cancel").addEventListener("click",(function(e){e.preventDefault(),document.getElementById("overlay").classList.remove("overlay_visible"),n.classList.remove("popup_visible")})),n.querySelector("#fb-auth-email-submit").addEventListener("click",(function(e){e.preventDefault();document.querySelector("#fb-auth-email-form");let t=document.querySelector("#fb-auth-email-wrapper"),r=document.querySelector("#fb-auth-email"),a=document.querySelector(".popup__fb-auth-email-error-message");if(0===r.value.length)t.classList.add("error"),a.innerHTML="Email field cannot be empty";else{var n=this;let e=addPreloader(n),t={email:r.value};rtrv.authorizeWithFB(t).then((function(e){rtGlobalObj.user.data=e,e.is_pro&&(rtGlobalObj.tracking.properties.membership_level="roadtrippers plus");let t=Object.assign({},rtGlobalObj.tracking.properties);t.authenticated_by="facebook";let r="User Signed In";e.new_user&&(r="User Signed Up",analytics.alias(e.id)),analytics.identify(e.id,{id:e.id.toString(),username:e.username,email:e.email,name:e.name},(function(){analytics.track(r,t,{},(function(){rtGlobalObj.user.data.is_pro?setCookie(cookieName,proUser,!0):e.new_user?setCookie(cookieName,regUser,!0,"eoi"):setCookie(cookieName,regUser,!0)}))}))}),(function(t){t.errors&&"Email must be valid"===t.errors[0].message?a.innerHTML="Email does not appear to be valid. Please enter another and try again.":t.errors&&(a.innerHTML=t.errors[0].message),removePreloader(n,e)}))}}));let p=document.getElementsByClassName("authorize-with-roadpass");for(let e=0;e<p.length;e++)p[e].addEventListener("click",(function(e){e.preventDefault();addPreloader(this);let t={},r=this.dataset.state;t.clientState=r;let a="maps."+rtGlobalObj.rtApi.hostUrl;a&&(t.mapsHost=a);var n=this.dataset.location,o=this.dataset.context;if("module sign up"==n){let e=window.location.href;e=e+"#"+this.closest(".page-content-item").id,t.returnTo=e}if(void 0!==o){let e=Object.assign({},rtGlobalObj.tracking.properties);e.context=o,e.authenticated_by="roadpass",analytics.track("Authentication Initiated",e,{},(function(){rtrv.authorizeWithRoadpass(t)}))}else rtrv.authorizeWithRoadpass(t)}));let m=document.getElementsByClassName("authorize-with-apple");for(let e=0;e<m.length;e++)m[e].addEventListener("click",(function(e){e.preventDefault();var t=this.dataset.context;if(void 0!==t){let e=Object.assign({},rtGlobalObj.tracking.properties);e.context=t,e.authenticated_by="apple",analytics.track("Authentication Initiated",e,{},(function(){rtrv.authorizeWithApple()}))}else rtrv.authorizeWithApple()}));let g=document.getElementsByClassName("marketing-email-optin-submit");for(let e=0;e<g.length;e++)g[e].addEventListener("click",(function(e){e.preventDefault();addPreloader(this);rtrv.updateUser({marketing_emails_opt_in:!0,new_user:!1}).then((function(e){document.getElementById("marketing-optin-popup-close").click()}))}));if(a)for(let e=0;e<a.length;e++)a[e].addEventListener("click",(function(){rtrv.logout().then((function(){analytics.reset(),deleteCookie(cookieName,!0)}),(function(){}))}))}})),document.addEventListener("analyticsReady",(function(){let e=document.getElementsByClassName("proactive-roadpass-connect");for(let t=0;t<e.length;t++)e[t].addEventListener("click",(function(e){e.preventDefault();addPreloader(this);let t={},r="maps."+rtGlobalObj.rtApi.hostUrl;r&&(t.mapsHost=r),t.clientState="connect";let a=Object.assign({},rtGlobalObj.tracking.properties);a.context="connect modal",analytics.track("Account Migration Initiated",a,{},(function(){rtrv.authorizeWithRoadpass(t)}))}))})),document.addEventListener("analyticsReady",(function(){if(window.location.search.length>0&&window.location.href.indexOf("roadpass_redirect")>0&&0!==Object.entries(rtGlobalObj.user.data).length&&rtGlobalObj.user.data.constructor===Object){let e=Object.assign({},rtGlobalObj.tracking.properties);e.authenticated_by="roadpass";let t="User Signed In";rtGlobalObj.user.data.new_user&&(t="User Signed Up",analytics.alias(rtGlobalObj.user.data.id)),analytics.identify(rtGlobalObj.user.data.id,{id:rtGlobalObj.user.data.id.toString(),username:rtGlobalObj.user.data.username,name:rtGlobalObj.user.data.name,email:rtGlobalObj.user.data.email},(function(){analytics.track(t,e)}))}})),document.addEventListener("analyticsReady",(function(){if(window.location.search.length>0&&window.location.href.indexOf("apple_login")>0&&0!==Object.entries(rtGlobalObj.user.data).length&&rtGlobalObj.user.data.constructor===Object){let e="";window.location.href.indexOf("?apple_login&")>0?e=window.location.href.replace("apple_login&",""):window.location.href.indexOf("&apple_login")>0?e=window.location.href.replace("&apple_login",""):window.location.href.indexOf("?apple_login")>0&&(e=window.location.href.replace("?apple_login",""));let t=Object.assign({},rtGlobalObj.tracking.properties);t.authenticated_by="apple";let r="User Signed In";rtGlobalObj.user.data.new_user&&(r="User Signed Up",analytics.alias(rtGlobalObj.user.data.id),show_roadpass_modal("marketing-email")),analytics.identify(rtGlobalObj.user.data.id,{id:rtGlobalObj.user.data.id.toString(),username:rtGlobalObj.user.data.username,name:rtGlobalObj.user.data.name,email:rtGlobalObj.user.data.email},(function(){analytics.track(r,t,{},(function(){rtGlobalObj.user.data.new_user||(window.location.href=e)}))}))}})),document.addEventListener("userReady",(function(){if(window.location.search.length>0&&window.location.href.indexOf("eoi")>0&&0!==Object.entries(rtGlobalObj.user.data).length&&rtGlobalObj.user.data.constructor===Object){Object.assign({},rtGlobalObj.tracking.properties);rtGlobalObj.user.data.new_user&&show_roadpass_modal("marketing-email")}}));