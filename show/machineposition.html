<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>农业大数据研究与管理平台</title>
    <link rel="stylesheet" href="../theme/default/easyui.css" />
    <link rel="stylesheet" type="text/css" href="../css/app.css" />
    <link rel="stylesheet" type="text/css" href="../css/main.css" />
    <link type="text/css" href="../css/dev.css" rel="stylesheet" />
    <link rel="stylesheet" type="text/css" href="../css/icon.css" />
    <script type="text/javascript" src="../js/jquery.min.js"></script>
    <script type="text/javascript" src="../js/dev.ui.js"></script>
    <script type="text/javascript" src="../js/data.util.js"></script>
    <script type="text/javascript" src="../js/ol.min.3.2.1.js"></script>
    <script type="text/javascript" src="../js/jquery.easyui.min.js"></script>
    <script type="text/javascript" src="../js/easyui-lang-zh_CN.js"></script>
    <script type="text/javascript" src="js/show.gis.js"></script>
    <script type="text/javascript" src="../js/linq.min.js"></script>
    <script type="text/javascript" src="../js/guid.js"></script>
    <script type="text/javascript" src="../js/jquery.dev.js"></script>
    <script type="text/javascript" src="../js/jquery.cookie.js"></script>
    <style type="text/css">
        .position_content {
            width: 100%;
            height: calc(100% - 33px);
            background: url(showimg/logo_1.png) no-repeat top,-webkit-radial-gradient(#000c09 30%,#000c09 70%);
            background: url(showimg/logo_1.png) no-repeat top,-o-radial-gradient(#000c09 30%,#000c09 70%);
            background: url(showimg/logo_1.png) no-repeat top,-moz-radial-gradient(#000c09 30%,#000c09 70%);
            background: url(showimg/logo_1.png) no-repeat top,radial-gradient(#000c09 30%,#000c09 70%);
            position: relative;
        }

        .fillpanel {
            width: 100%;
            height: 100%;
            display: none;
            position: absolute;
            top: 0;
        }

        .mappanel {
            width: 96%;
            height: calc(100% - 140px);
            /*background: url(showimg/topl.png),url(showimg/topr.png),url(showimg/bottoml.png),url(showimg/bottomr.png),url(showimg/divbg.png) no-repeat center/100% 100%;*/
            /*background-repeat: no-repeat,no-repeat,no-repeat,no-repeat;*/
            /*background-position: top left,top right,bottom left,bottom right;*/
            left: 2%;
            top: 110px;
            position: absolute;
        }

        .mappaneldom {
            float: left;
            margin: 3px;
            width: calc(100% - 6px);
            height: calc(100% - 6px);
            display: inline-block;
        }

        /* 底部样式 */
        footer {
            background-color: #363636;
            font-size: 14px;
            color: #fff;
            line-height: 33px;
            position: relative;
            bottom: 0;
            left: 0;
            right: 0;
            width: 100%;
            height: 33px;
            text-align: center;
        }

        #infobtn {
            position: absolute;
            top: 65px;
            left: 2%;
            width: 140px;
            height: 50px;
            cursor: pointer;
            background: url(showimg/backindex.png) no-repeat center/100% 100%;
        }

        /*#infobtn:hover {
                background: url(showimg/backindex-h.png) no-repeat center/100% 100%;
            }*/

        .machinetip {
            position: absolute;
            right: 5px;
            top: 10px;
            width: 566px;
            height: 30px;
            background: url(showimg/positionbg.png) no-repeat left/100% 100%;
            z-index: 10005;
        }

            .machinetip span {
                color: #ffffff;
                font-weight: bold;
                line-height: 30px;
                margin-left: 5px;
            }
    </style>
    <script type="text/javascript">
        var Config;
        var devicenos;
        var timeinterval;
        var uav_demopoint = [126.83559512257342, 45.84369942693733];
        var njwidth1 = 8;
        var njwidth2 = 5.85;
        var njwidth3 = 5.85;
        var njwidth4 = 2.6;
        function GetRootPath() {
            var pathName = window.document.location.pathname;
            var localhost = window.location.host;
            var projectName = pathName.substring(0, pathName.substr(1).indexOf('/') + 1);
            return ("http://" + localhost + projectName + "/");
        }
        $(window).ready(function () {
            var u = $.cookie("usertoken");
            if (u == undefined || u == null) {
                this.user = null;
                if (dev.cookie.rootPath == undefined || dev.cookie.rootPath == null) dev.cookie.rootPath = dev.cookie.getRootPath();
                location.href = dev.cookie.rootPath + "login.html";
            }
            //初始化地图
            dev.cookie.user = JSON.parse($.cookie("usertoken"));
            dev.App.MapPanel = $(".mappanel");
            dev.App.MapPanel.Target = $(".mappanel");
            dev.App.FillPanel = new dev.FillPanel($(".fillpanel"));
            dev.App.MapPanel.MapDOM = $(".mappaneldom");
            if (dev.IsNull(Config)) {
                var config = null;
                $.ajax({
                    url: "../config/app.xml",
                    dataType: 'xml',
                    type: 'GET',
                    cache: false,
                    timeout: 2000,
                    async: false,
                    error: function (xml) {
                        alert("加载系统配置文件出错！");
                        return;
                    },
                    success: function (xml) {
                        config = $.xml2json(xml);
                    }
                });
                dev.App.Config = Config = config;
            }
            dev.App.Root = GetRootPath();
            initMap();
            var templayer = dev.MapUtils.GetLayer("tempGraphicLayer", dev.App.Map);
            templayer.setZIndex(10005);
            getdevices();
            getbozhong();
            $("#infobtn").click(function () {
                window.open(GetRootPath() + "show/index.html", "_self");
            });
            //添加模型无人机
            var demouav = new ol.Feature(new ol.geom.Point(uav_demopoint));
            demouav.setId("uav_hlj_0001");
            demouav.setStyle(new ol.style.Style({
                image: new ol.style.Icon(({
                    crossOrigin: 'anonymousdemo',
                    src: dev.App.Root + "show/showimg/uav_demo.png",
                    rotation: 0
                })),
                text: new ol.style.Text({ text: "", font: "15px serif", offsetX: 5, offsetY: -20, fill: new ol.style.Fill({ color: [255, 255, 255, 1] }), backgroundFill: new ol.style.Fill({ color: [0, 153, 204, 0.8] }), placement: 'point' })
            }));
            dev.MapUtils.AddFeature(demouav, "tempGraphicLayer", dev.App.Map);
            //添加闪烁
            var curr_pointkey = dev.MapUtils.PointSymbolStyle1(demouav, 1, "rgba(81,58,255, 1)", "rgba(81,58,255,0.5)", 30, dev.App.Map);
        });

        //初始化map
        function initMap() {
            var initconfig = Config.SystemMap;
            var resolutions;
            if (!dev.IsNull(initconfig.LevelInfo) && !dev.IsNull(initconfig.LevelInfo.IsVisibleLevel) && initconfig.LevelInfo.IsVisibleLevel == "true") {
                resolutions = [];
                for (var i = 0; i < initconfig.LevelInfo.Levels.length; i++) resolutions.push(parseFloat(initconfig.LevelInfo.Levels[i].Resolution));
            }
            var view = new ol.View({
                projection: ol.proj.get('EPSG:4326'),
                resolutions: resolutions,
                minZoom: 1,
                maxResolution: resolutions[resolutions.length - 1],
                maxZoom: 20,
                minResolution: resolutions[0],
            });
            pestsMap = new ol.Map({
                controls: new ol.control.defaults({ zoom: false, rotate: false, attribution: false }),
                interactions: ol.interaction.defaults().extend([new ol.interaction.DragRotateAndZoom()]),
                target: $(".mappaneldom")[0],
                logo: false,
                view: view
            });
            dev.App.Map = pestsMap;
            dev.MapLoad.InitMap($.extend({ Map: pestsMap }, initconfig), true);
            //添加无人机影像
            var uav_hlj = dev.getLayerbyValue(['230104image1']);
            if (dev.IsNull(uav_hlj) || uav_hlj.length == 0) return;
            var uav_layer = uav_hlj[0];
            var param = {
                ID: uav_hlj.Value,
                Url: dev.MapLoad.GetUrlByRelID(uav_layer.Url),
                Map: dev.App.Map,
                Layers: uav_layer.TypeName,
                Resolution: "0.703125",
                Level: 20,
                ZIndex: 1000
            }
            if (!dev.IsNull(uav_layer.Envelop)) {
                var arr = uav_layer.Envelop.split(',');
                param.Extent = [parseFloat(arr[0]), parseFloat(arr[1]), parseFloat(arr[2]), parseFloat(arr[3])];
            }
            dev.MapLoad.AddWMTSLayer(param);
        }

        //获取设备
        var ajaxRequests = [];
        var devicelist;
        var pointskey = [], devicepoints = [];
        var track_points = [];
        var deviceoverlays = [];
        function getdevices() {
            var orgid = dev.cookie.user.orgid;
            var ajaxrequest = $.ajax({
                type: "POST",
                data: { orgId: orgid },
                dataType: 'json',
                url: dev.MapLoad.GetUrlByRelID("Service") + "realti/getOrgTreeAndRealTimeData",
                success: function (response) {
                    if (dev.IsNull(response.orgList) || dev.IsNull(response.realTimeList)) return;
                    devicelist = response.realTimeList;
                    devicenos = "";
                    for (var i = 0; i < devicelist.length; i++) {
                        if (!dev.IsNull(devicelist[i].no)) devicenos += "'" + devicelist[i].no + "',";
                        track_points.push({ key: devicelist[i].id, ps: [[parseFloat(devicelist[i].longitude), parseFloat(devicelist[i].latitude)]] });
                    }
                    devicenos = devicenos.substr(0, devicenos.length - 1);
                    adddevice();
                    setview(response.realTimeList);
                    if (dev.IsNull(timeinterval)) timeinterval = setInterval("getrefreshdata()", 5000);
                }
            });
            ajaxRequests.push(ajaxrequest);
        }

        //界面添加设备
        function adddevice() {
            var features = [];
            for (var i = 0; i < devicepoints.length; i++) {
                var currf = dev.MapUtils.GetFeatureByID(devicepoints[i].key, "tempGraphicLayer", dev.App.Map);
                dev.MapUtils.RemoveFeature(currf, "tempGraphicLayer", dev.App.Map);
            }
            devicepoints = [];
            for (var i = 0; i < pointskey.length; i++) {
                dev.MapUtils.removePointKey(pointskey[i].key);
            }
            pointske = [];
            for (var i = 0; i < devicelist.length; i++) {
                var curr_pointf = new ol.Feature(new ol.geom.Point([parseFloat(devicelist[i].longitude), parseFloat(devicelist[i].latitude)]));
                curr_pointf.setId(devicelist[i].id);
                var styleparam = getstylebyinfo(devicelist[i]);
                curr_pointf.setStyle(new ol.style.Style({
                    image: new ol.style.Icon({
                        src: getimgsrc(devicelist[i]),
                        rotateWithView: false,
                        rotation: 0
                    })
                }));
                features.push(curr_pointf);
                devicepoints.push({ key: devicelist[i].id, pointf: curr_pointf });
                //添加农机提示
                var tipdiv = $('<div style="height:26px;line-height:26px;background-color:rgba(0,58,255,0.8);border:1px solid #0099cc; border-radius:3px;color:#ffff;font-size:15px;">' + devicelist[i].no + "：" + parseFloat(devicelist[i].speed).toFixed(2) + 'km/h </div>');
                var currdevicetip = new ol.Overlay({
                    id: devicelist[i].id + new Date().getTime(),
                    stopEvent: false,
                    offset: [5, -20],
                    positioning: "center-center",
                    element: tipdiv[0]
                });
                currdevicetip.setPosition([parseFloat(devicelist[i].longitude), parseFloat(devicelist[i].latitude)]);
                dev.App.Map.addOverlay(currdevicetip);
                deviceoverlays.push({ key: devicelist[i].id, overlay: currdevicetip });
                var curr_pointkey = dev.MapUtils.PointSymbolStyle1(curr_pointf, 1, styleparam.color, styleparam.fillcolor, 30, dev.App.Map);
                pointskey.push({ key: devicelist[i].id, pointKey: curr_pointkey });
            }
            dev.MapUtils.AddFeatures(features, "tempGraphicLayer", null, dev.App.Map);
        }
        function getimgsrc(info) {
            var src = "";
            if (info.devicetype == dev.DeviceType.machine) {
                src = dev.App.Root + "show/showimg/untractor.png";
                if (info.onlineState == "1") src = dev.App.Root + "show/showimg/tractor.png";
            }
            else {
                src = dev.App.Root + "show/showimg/unuav.png";
                if (info.onlineState == "1") src = dev.App.Root + "show/showimg/uav.png";
            }
            return src;
        }
        //设定范围
        function setview(realist) {
            //  var extent = [126.81680278208522, 45.8263323806762, 126.85861730661681, 45.85178603000698]
            //  dev.App.Map.getView().fit(extent, dev.App.Map.getSize());
            dev.App.Map.getView().setCenter([126.83674283980477, 45.843822808552034]);
            dev.App.Map.getView().setZoom(20);
            //if (dev.IsNull(realist)) return;
            //for (var i = 0; i < realist.length; i++) {
            //    realist[i].x = parseFloat(realist[i].longitude);
            //    realist[i].y = parseFloat(realist[i].latitude);
            //}
            //var extend;
            //if (realist.length == 1) {
            //    var ext = dev.MapUtils.GetExtentByMapClick([parseFloat(realist[0].x), parseFloat(realist[0].y)], dev.App.Map, 2);
            //    if (!dev.IsNull(ext)) extend = ext.getExtent();
            //}
            //else if (realist.length > 1) extend = dev.getExtentByPoints(realist);
            //if (!dev.IsNull(extend)) dev.App.Map.getView().fit(extend, dev.App.Map.getSize());
        }

        //实时刷新
        function getrefreshdata() {
            var condition = "1=1";
            if (!dev.IsNull(devicenos)) condition += ' AND \"NO\" IN(' + devicenos + ')';
            var ajaxparam = $.ajax({
                type: "POST",
                contentType: 'application/json',
                dataType: 'json',
                data: condition,
                url: dev.MapLoad.GetUrlByRelID("Service") + "realti/getbyfilter",
                success: function (result) {
                    if (result.statusCode != 200 || result.data.length == 0) return;
                    devicelist = result.data;
                    refreshdata();
                }

            });
            //显示播种信息
            getbozhong();
        }
        //获取播种信息
        function getbozhong() {
            $.ajax({
                url: "http://njgjapp.com:8002/api/FarmerProfile/SetData",
                type: "GET",
                async: false,
                success: function (data) {
                    var spans = $("span", $(".machinetip"));
                    for (var i = 0; i < spans.length; i++) {
                        var currspan = $(spans[i]);
                        var name = currspan.attr("name");
                        var value = data[name];
                        if (name == "newStartDate") {
                            var year = value.substr(0, 4);
                            var month = value.substr(4, 2);
                            var day = value.substr(6, 2);
                            var hour = value.substr(8, 2);
                            var mins = value.substr(10, 2);
                            var seconds = value.substr(12, 2);
                            value = year + "-" + month + "-" + day + " " + hour + ":" + mins + ":" + seconds;
                        }
                        currspan.html(value);
                    }
                }
            });
        }
        //刷新地图
        function refreshdata() {
            // clearmapdata();
            var cfeatures = [];
            for (var i = 0; i < devicelist.length; i++) {
                var curr_devicepoints = Enumerable.From(track_points).Where('s=>s.key=="' + devicelist[i].id + '"').FirstOrDefault();
                var x = parseFloat(devicelist[i].longitude);
                var y = parseFloat(devicelist[i].latitude);
                if (dev.IsNull(curr_devicepoints)) track_points.push({ key: devicelist[i].id, ps: [[x, y]] });
                else {
                    var index = Enumerable.From(track_points).IndexOf(curr_devicepoints);
                    var lastpoint = track_points[index].ps[track_points[index].ps.length - 1];
                    //改变闪烁和设备的在线状态
                    var points_f = Enumerable.From(devicepoints).Where('s=>s.key=="' + devicelist[i].id + '"').FirstOrDefault();
                    //修改闪烁样式
                    var styleparam = getstylebyinfo(devicelist[i]);
                    if (lastpoint[0] != x || lastpoint[1] != y) {
                        track_points[index].ps.push([x, y]);//刷新路线
                        //加载路线
                        dev.MapUtils.RemoveFeatureLikeID("trackline" + devicelist[i].id, "tempGraphicLayer", dev.App.Map);
                        var linepoint = new ol.Feature(new ol.geom.LineString(curr_devicepoints.ps));
                        linepoint.setId("trackline" + devicelist[i].id);
                        cfeatures.push(linepoint);
                        //添加路线缓冲
                        if (devicelist[i].devicetype == dev.DeviceType.machine) {
                            var buffer = 2;
                            if (devicelist[i].no == "HLJ02") buffer = njwidth2;
                            if (devicelist[i].no == "HLJ03") buffer = njwidth3;
                            if (devicelist[i].no == "HLJ04") buffer = njwidth4;
                            if (devicelist[i].no == "HLJ01") buffer = njwidth1;
                            var polygon_geom = getbufferpolygon(lastpoint, [x, y], buffer);
                            var lastpolygon = new ol.Feature(polygon_geom);
                            lastpolygon.setId("trackpolygon" + new Date().getTime());
                            cfeatures.push(lastpolygon);
                        }
                        //设置设备角度和位置
                        (points_f.pointf.getGeometry()).setCoordinates([x, y]);//设置位置
                        var anger = getrotation(lastpoint, [x, y]);
                        points_f.pointf.setStyle(new ol.style.Style({  //设置角度和样式
                            image: new ol.style.Icon(({
                                crossOrigin: 'anonymous',
                                src: styleparam.iconsrc,
                                rotation: anger * Math.PI / 180
                            }))
                        }));
                        //转换tip
                        var texttip = Enumerable.From(deviceoverlays).Where('s=>s.key=="' + devicelist[i].id + '"').FirstOrDefault();
                        if (!dev.IsNull(texttip)) texttip.overlay.setPosition([x, y]);
                        //刷新闪烁位置
                        var currpointkey = Enumerable.From(pointskey).Where('s=>s.key=="' + devicelist[i].id + '"').FirstOrDefault();
                        if (!dev.IsNull(currpointkey)) {
                            dev.MapUtils.removePointKey(currpointkey.key, dev.App.Map);
                            pointskey = Enumerable.From(pointskey).Where('s=>s.key=="' + devicelist[i].id + '"').ToArray();
                        }
                        var curr_pointkey = dev.MapUtils.PointSymbolStyle1(points_f.pointf, 1, styleparam.color, styleparam.fillcolor, 30, dev.App.Map);
                        pointskey.push({ key: devicelist[i].id, pointKey: curr_pointkey });
                    }
                }
            }
            dev.MapUtils.AddFeatures(cfeatures, "tempGraphicLayer", null, dev.App.Map);

        }

        //获取样式
        function getstylebyinfo(info) {
            if (dev.IsNull(info)) return;
            var iconsrc = "";
            var color = "";
            var fillcolor = "";
            if (info.devicetype == dev.DeviceType.machine) {
                iconsrc = dev.App.Root + "show/showimg/untractor.png";
                color = "rgba(153,153,153,1)";
                fillcolor = "rgba(153,153,153,0.5)";
                if (info.onlineState == "1") {
                    color = "rgba(63,85,225,1)";
                    fillcolor = "rgba(63,85,225,0.5)";
                    iconsrc = dev.App.Root + "show/showimg/tractor.png";
                }
                if (info.onlineState == "1" && info.barrierflag == "是") {
                    color = "rgba(255,0,0,1)";
                    fillcolor = "rgba(255,0,0,0.5)";
                }
            }
            else {
                color = "rgba(153,153,153,1)";
                fillcolor = "rgba(153,153,153,0.5)";
                iconsrc = dev.App.Root + "show/showimg/unuav.png";
                if (info.onlineState == "1") {
                    color = "rgba(63,85,225,1)";
                    fillcolor = "rgba(63,85,225,0.5)";
                    iconsrc = dev.App.Root + "show/showimg/uav.png";
                }
                if (info.onlineState == "1" && info.barrierflag == "是") {
                    color = "rgba(255,0,0,1)";
                    fillcolor = "rgba(255,0,0,0.5)";
                }
            }
            return { iconsrc: iconsrc, color: color, fillcolor: fillcolor };
        }

        //根据线获取缓冲图形
        function getbufferpolygon(point1, point2, buffer) {
            if (dev.IsNull(buffer)) buffer = 2;
            buffer = buffer / 2;
            var temppoint1 = new ol.proj.transform(point1, dev.App.Map.getView().getProjection(), "EPSG:3857");
            var temppoint2 = new ol.proj.transform(point2, dev.App.Map.getView().getProjection(), 'EPSG:3857');
            var lonlat = { lon: temppoint1[0], lat: temppoint1[1] };
            var lastLonlat = { lon: temppoint2[0], lat: temppoint2[1] };

            var x1 = lastLonlat.lon - buffer * Math.sin(Math.atan((lonlat.lat - lastLonlat.lat) / (lonlat.lon - lastLonlat.lon)));
            var y1 = lastLonlat.lat + buffer * Math.cos(Math.atan((lonlat.lat - lastLonlat.lat) / (lonlat.lon - lastLonlat.lon)));

            var x2 = lastLonlat.lon + buffer * Math.sin(Math.atan((lonlat.lat - lastLonlat.lat) / (lonlat.lon - lastLonlat.lon)));
            var y2 = lastLonlat.lat - buffer * Math.cos(Math.atan((lonlat.lat - lastLonlat.lat) / (lonlat.lon - lastLonlat.lon)));

            var x3 = lonlat.lon - buffer * Math.sin(Math.atan((lastLonlat.lat - lonlat.lat) / (lastLonlat.lon - lonlat.lon)));
            var y3 = lonlat.lat + buffer * Math.cos(Math.atan((lastLonlat.lat - lonlat.lat) / (lastLonlat.lon - lonlat.lon)));

            var x4 = lonlat.lon + buffer * Math.sin(Math.atan((lastLonlat.lat - lonlat.lat) / (lastLonlat.lon - lonlat.lon)));
            var y4 = lonlat.lat - buffer * Math.cos(Math.atan((lastLonlat.lat - lonlat.lat) / (lastLonlat.lon - lonlat.lon)));

            if (isNaN(x1) || isNaN(y1) || isNaN(x2) || isNaN(y2) || isNaN(x3) || isNaN(y3) || isNaN(x4) || isNaN(y4)) return null;
            var p1 = new ol.proj.transform([x1, y1], "EPSG:3857", dev.App.Map.getView().getProjection());
            var p2 = new ol.proj.transform([x2, y2], "EPSG:3857", dev.App.Map.getView().getProjection());
            var p3 = new ol.proj.transform([x3, y3], "EPSG:3857", dev.App.Map.getView().getProjection());
            var p4 = new ol.proj.transform([x4, y4], "EPSG:3857", dev.App.Map.getView().getProjection());
            var points = [p1, p2, p4, p3, p1];
            var geom = new ol.geom.Polygon([points]);
            return geom;
        }

        //获取两点的距离
        function distancebypoints(startpoint, endpoint) {
            if (dev.IsNull(startpoint) || dev.IsNull(endpoint)) return null;
            var wgs84Sphere = new ol.Sphere(6378137);
            var disctance = wgs84Sphere.haversineDistance(startpoint, endpoint);
            return disctance;
        }

        //获取角度
        function getrotation(curPos, targetPos) {
            curPos = dev.App.Map.getPixelFromCoordinate(curPos);
            targetPos = dev.App.Map.getPixelFromCoordinate(targetPos);
            curPos = { x: curPos[0], y: curPos[1] };
            targetPos = { x: targetPos[0], y: targetPos[1] };
            var x = Math.abs(targetPos.x - curPos.x);
            var y = Math.abs(targetPos.y - curPos.y);
            var z = Math.sqrt(x * x + y * y);
            var ration = Math.round((Math.asin(y / z) / Math.PI * 180));
            var a = 0;
            if (targetPos.y < curPos.y && targetPos.x == curPos.x) a = 270;
            else if (targetPos.y > curPos.y && targetPos.x == curPos.x) a = 90;
            else if (targetPos.y == curPos.y && targetPos.x < curPos.x) a = 180;
            else if (targetPos.y == curPos.y && targetPos.x > curPos.x) a = 0
            else if (targetPos.y > curPos.y && targetPos.x > curPos.x) a = ration;
            else if (targetPos.y > curPos.y && targetPos.x < curPos.x) a = 180 - ration;
            else if (targetPos.y < curPos.y && targetPos.x < curPos.x) a = 180 + ration;
            else if (targetPos.y < curPos.y && targetPos.x > curPos.x) a = 360 - ration;
            return a;
        }

        //清空地图
        function clearmapdata() {
            for (var i = 0; i < pointskey.length; i++) {
                dev.MapUtils.removePointKey(pointskey[i].pointKey, pointskey[i].key);
                pointskey[i].pointKey = null
                pointskey[i] = null;
            }
            pointskey = [];
        }

    </script>
</head>
<body>
    <div class="position_content">
        <div id="infobtn"></div>
        <div class="mappanel">
            <div class="machinetip">
                <span style="margin-left: 40px;">亩播量</span>
                <span name="AcreSowingAmount"></span>
                <span>|</span>
                <span>面积</span>
                <span name="Area"></span>
                <span>|</span>
                <span>株距</span>
                <span name="zhuju"></span>
                <span>|</span>
                <span>播种数</span>
                <span name="Seed"></span>
                <span>|</span>
                <span>时间</span>
                <span name="newStartDate"></span>
            </div>
            <div class="mappaneldom"></div>
        </div>
    </div>
    <div class="fillpanel">
    </div>
    <footer>
        Copyright © 2017-2020 &nbsp;&nbsp; 北京禾壮慧农科技发展有限公司&nbsp;&nbsp; 版权所有
    </footer>
</body>
</html>
