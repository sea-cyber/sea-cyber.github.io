<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>农户管理</title>
    <link rel="stylesheet" href="../../theme/default/easyui.css" />
    <link rel="stylesheet" type="text/css" href="../../theme/icon.css" />
    <link rel="stylesheet" type="text/css" href="../../css/app.css" />
    <link rel="stylesheet" type="text/css" href="../../css/main.css" />
    <link rel="stylesheet" type="text/css" href="../../css/icon.css" />
    <link type="text/css" href="../../css/dev.css" rel="stylesheet" />
    <script type="text/javascript" src="../../js/jquery.min.js"></script>
    <script type="text/javascript" src="../../js/jquery.easyui.min.js"></script>
    <script type="text/javascript" src="../../js/easyui-lang-zh_CN.js"></script>
    <script type="text/javascript" src="../../js/linq.min.js"></script>
    <script type="text/javascript" src="../../js/data.util.js"></script>
    <script type="text/javascript" src="../../js/jquery.dev.control.js"></script>
    <script src="../../js/jquery.jdirk.js"></script>
    <script src="../../js/dev.ui.js"></script>
    <style type="text/css">
        .content {
            height: 100%;
            width: 100%;
            position: relative;
        }

        .Title {
            width: 75px;
            text-align: right;
            line-height: 40px;
            height: 38px;
            display: inline-block;
            float: left;
        }

            .Title .Icon {
                width: 16px;
                height: 16px;
                display: inline-block;
                margin-top: 11px;
            }

            .Title .Text {
                display: inline-block;
                float: right;
            }

        .content .SearchDiv {
            width: 210px;
            height: 40px;
            display: inline-block;
            margin-left: 0px;
            margin-right: 0px;
            float: left;
        }

        .Button {
            width: 70px;
            height: 26px;
            float: left;
            margin-top: 7px;
            background-color: #16dbbb;
            text-align: center;
            border: 1px solid #16dbbb;
            display: inline-block;
            margin-left: 5px;
        }

            .Button:hover {
                background-color: #5227de;
                border: 1px solid #5227de;
                cursor: pointer;
            }
           .Button:active {
                background-color: #210097;
                border: 1px solid #210097;
                cursor: pointer;
            }

        .ButtonDisplay {
            display: none;
        }

        .datagrid-row {
            height: 28px;
        }

        .pagination-info {
            float: right;
            margin: 0 6px 0 0;
            padding: 0;
            margin-right: 17px;
            height: 30px;
            line-height: 30px;
            font-size: 12px;
        }
    </style>
    <script type="text/javascript">
        var Dev = window.top.window.dev;
        var parent;
        var dialog, flashDialog;
        var farmerWin;
        var treeControl, dataGrid;
        var orgFilter;
        var nationDic;  //  民族字典数据
        var comboTree, treedata;
        var xzqControl, xzqvlaues = {};
        var row;        //记录选中行
        var ajaxRequests = [];
        var filePath = "";
        var pageIndex = 1, pageSize = 5;
        var isUpdate = false, updateid;
        var filePhoto;//图片信息
        var msg = {
            netout: "网络超时，请稍后再试！",
            deleteFailed: "删除失败，请稍后再试！",
            deleteSuccess: "删除成功！",
            addSuccess: "操作成功！",
            OperationFailed: "操作失败，请稍后再试！",
        };
        function WidgetCommunication(s) {
            parent = s.parent;
            // Dev.App.BottomPanel.SetHeight(262);
            Dev.App.BottomPanel.Header.css({ "background": "#14cdad", "color": "#fcfcfc", "font-weight": "bold" });
            Dev.App.BottomPanel.SetIconCls("user-usermanage");
            initDataGrid();
            inittree();
            $(window).resize(function () { resize(); });
            if (Dev.cookie.user.posts[0].postowner == 1 && Dev.cookie.user.posts[0].mainpost == 1) {
                $("div[tag=add]").removeClass("ButtonDisplay");
                $("div[tag=deletes]").removeClass("ButtonDisplay");
                $(".button_div").width(325);
            }
            $(".Button").click(function () {
                var tag = $(this).attr("tag");
                if (tag == "search") {
                    pageIndex = 1;
                    search();
                }
                if (tag == "clear") { searchClear(); pageIndex = 1; search(); };
                if (tag == "add") { isUpdate = false; initWindow(false); }
                if (tag == "deletes") deletes();
                if (tag == "save") saveInfo();
                if (tag == "cancel") farmerWin.Close();
            });
            parent.one("onClosing", function () {
                Dev.App.BottomPanel.SetHeight(262);
                if (!Dev.IsNull(treeControl)) {
                    treeControl.unbind("onSelectChanged");
                    treeControl.Clear();
                    treeControl = null;
                }
                if (!Dev.IsNull(dataGrid)) {
                    dataGrid.Target.unbind("onSelectPage");
                    dataGrid.Target.unbind("onPageSizeChange");
                    dataGrid = null;
                }
                if (!Dev.IsNull(farmerWin)) {
                    farmerWin.Target.unbind("onClosing");
                    farmerWin.Close();
                    farmerWin.Destroy();
                    farmerWin = null;
                }

                if (!Dev.IsNull(detailWin)) {
                    detailWin.Target.unbind("onClosing")
                    detailWin.Close();
                    detailWin.Destroy();
                    detailWin = null;
                }
                if (ajaxRequests.length > 0) {
                    for (var i = 0; i < ajaxRequests.length; i++) {
                        ajaxRequests[i].abort();
                        ajaxRequests.splice(i, 1);
                    }
                }
            });                 //页面释放
            resize();
            flashDialog = new Dev.Messager({ Height: 95, Width: 200, AutoShow: false, Type: "question", Timeout: 1500, ButtonVisible: false, AutoVisible: true, Effect: "normal" });
            dialog = new Dev.Messager({ AutoShow: false, Type: "question" });
        }
        //初始化列表
        function initDataGrid() {
            if (Dev.IsNull(dataGrid)) {
                var columns = [
                    { field: "ck", width: 30, align: 'center', title: '勾选', sortable: false, checkbox: true },
                    {
                        field: "name", width: 50, align: 'center', title: '姓名', sortable: false, formatter: function (value, row, index) {
                            if (Dev.cookie.user.posts[0].postowner == 1 && Dev.cookie.user.posts[0].mainpost == 1) return value;
                            else return Dev.simpleencryp(value, 1, 0);
                        }
                    },
                    {
                        field: "cardid", width: 75, align: 'center', title: '身份证号', sortable: false, formatter: function (value, row, index) {
                            if (Dev.cookie.user.posts[0].postowner == 1 && Dev.cookie.user.posts[0].mainpost == 1) return value;
                            else return Dev.simpleencryp(value, 3, 4);
                        }
                    },
                    { field: "household", width: 30, align: 'center', title: '户口性质', sortable: false },
                    { field: "domicile", width: 50, align: 'center', title: '户籍地', sortable: false },
                    {
                        field: "mobilephone", width: 60, align: 'center', title: '电话号码', sortable: false, formatter: function (value, row, index) {
                            if (Dev.cookie.user.posts[0].postowner == 1 && Dev.cookie.user.posts[0].mainpost == 1) return value;
                            else return Dev.simpleencryp(value, 3, 3);
                        }
                    },
                    {
                        field: "bankcard", width: 65, align: 'center', title: '银行卡号', sortable: false, formatter: function (value, row, index) {
                            if (Dev.cookie.user.posts[0].postowner == 1 && Dev.cookie.user.posts[0].mainpost == 1) return value;
                            else return Dev.simpleencryp(value, 4, 3);
                        }
                    },
                    { field: "cultivated", width: 40, align: 'center', title: '耕地面积(亩)', sortable: false },
                    { field: "createdate", width: 80, align: 'center', title: '创建时间', sortable: false, formatter: function (value, row, index) { return Dev.GetDateString(value); } },
                    {
                        field: "_oprate", width: 50, align: 'center', title: '操作', sortable: false,
                        formatter: function (value, row, index) {
                            //    return '<a href="javascript:void(0)" style="color:blue;" onclick="update(\'' + row.id + '\',\'' + index + '\')" title="修改"><img src="../../image/agri/update.png"/></a>&nbsp;<a href="javascript:void(0)" style="color:blue;margin-left:6px;" onclick="deleteinfo(\'' + index + '\')" title="删除"><img src="../../image/agri/delete.png"/></a>&nbsp;<a href="javascript:void(0)" style="color:blue;margin-left:6px;" onclick="initTab(\'' + row.id + '\')" title="详细信息"><img src="../../image/agri/cartype.png"/></a>';
                            if (Dev.cookie.user.posts[0].postowner == 1 && Dev.cookie.user.posts[0].mainpost == 1) {
                                return '<a href="javascript:void(0)" style="color:blue;" onclick="update(\'' + row.id + '\',\'' + index + '\')" title="修改"><img src="../../image/agri/update.png"/></a>&nbsp;<a href="javascript:void(0)" style="color:blue;margin-left:6px;" onclick="initTab(\'' + row.id + '\')" title="详细信息"><img src="../../image/agri/cartype.png"/></a>&nbsp;<a href="javascript:void(0)" style="color:blue;margin-left:6px;" onclick="deleteinfo(\'' + index + '\')" title="删除"><img src="../../image/agri/delete.png"/></a>';
                            } else {
                                return '<a href="javascript:void(0)" style="color:blue;margin-left:6px;" onclick="initTab(\'' + row.id + '\')" title="详细信息"><img src="../../image/agri/cartype.png"/></a>';
                            }
                        }
                    }
                ];
                dataGrid = new UCDataGrid(Dev, { PageIndex: pageIndex, PageSize: pageSize, RowNumbers: false, ID: "farmergrid", pagequery: false, IsSizeSelect: true });
                $("#gridDiv").append(dataGrid.Target);
                dataGrid.Layout(columns);
                dataGrid.Target.bind("onSelectPage", function (s, e) {
                    pageIndex = e.index;
                    search();
                });
                dataGrid.Target.bind("onPageSizeChange", function (s, e) {
                    if (Dev.IsNull(e)) return;
                    pageIndex = 1;
                    pageSize = e;
                    search();
                });
            }
        }
        //初始化组织机构树
        function inittree() {
            treeControl = $('.dev-tree').prop("$this");
            treeControl.bind("onSelectChanged", function (s, e) {
                pageIndex = 1;          //切换组织结构时，从第一面开始显示
                searchClear();
                var treenode = e;
                var isleaf = treeControl.IsLeaf(treenode);
                var orgids = [];
                orgids.push(e.id);
                if (!isleaf) {
                    var allchilds = treeControl.GetAllChildren(treenode);
                    for (var i = 0; i < allchilds.length; i++) orgids.push(allchilds[i].id);
                }
                orgFilter = "";
                if (Dev.IsNull(orgids) || orgids.length == 0) return;
                orgFilter = "\"ORGID\"  IN(";
                for (var i = 0; i < orgids.length; i++) orgFilter += "'" + orgids[i] + "',";
                orgFilter = orgFilter.substr(0, orgFilter.length - 1);
                orgFilter += ")";
                search();
            });
            var orgid = Dev.cookie.user.orgid;
            var ajaxrequest = $.ajax({
                url: Dev.GetSystemUrlByRelID("Service") + "organize/gettreebyid/" + orgid + "?" + new Date().getTime(),
                type: "Get",
                contentType: 'application/json',
                dataType: 'json',
                success: function (result) {
                    treedata = Dev.ConvertTreeData(result.data, orgid);
                    treeControl.LoadData(treedata);
                    if (treedata.length > 0) treeControl.SetSelectNode(treeControl.GetRoots()[0]);
                }
            });
            ajaxRequests.push(ajaxrequest);
            search();
        }
        //查询农户信息
        function search() {
            var ajaxrequest = $.ajax({
                type: "POST",
                data: getCondition(),
                contentType: "application/json",
                url: Dev.GetSystemUrlByRelID("Service") + "farmer/" + "getbyfilter/" + pageIndex + "/" + pageSize,
                success: function (result) {
                    if (result.statusCode != 200 || Dev.IsNull(result.data)) loadError();
                    else dataGrid.Load(result.data.dataSource, result.data.pageInfo);
                },
                error: function (e) {
                    //flashDialog.Alert("查询失败！", "error");
                    loadError();
                }
            });
            ajaxRequests.push(ajaxrequest);
        }
        var detailWin;
        function initTab(farmerId) {
            if (Dev.IsNull(detailWin)) {
                detailWin = new Dev.Window({
                    ID: "addwin",
                    IconCls: 'machine-trackedit',
                    Title: "农户详情",
                    Parent: Dev.App.FillPanel.Target,
                    Maximizable: false,
                    Modal: true,
                    Draggable: true,
                    HAlign: 'center',
                    VAlign: 'center',
                    Resizable: false,
                    Url: Dev.App.Root + "html/rotation/farmerdetail1.html",
                    Height: 400,
                    Width: 600,
                    Parameters: { farmerId: farmerId }
                });
                detailWin.bind("onClosing", function () {
                });
            } else {
                detailWin.SetUrl(Dev.App.Root + "html/rotation/farmerdetail1.html");
                detailWin.Parameters = { farmerId: farmerId };
                detailWin.Open();
            }
        } //初始化Tab页
        function initEwinParts() {
            comboTree = new Dev.Combotree({
                Required: true, PopupHeight: 120, TipInfo: "请选择",
                MultiSelect: false, StateField: "State", ValueField: "id",
                TextField: "name", ChildrenField: "child", Height: 24, Border: "1px", Width: 149
            });
            $("#treecomboDiv", farmerWin.Target).append(comboTree.Target);
            $("#photo", farmerWin.Target).bind("change", function () { uploadPhoto(this, "photo"); });//图片上传
            $("#btnDel", farmerWin.Target).click(function () { deletePhoto(); });//删除图片
            $("#basicdiv", farmerWin.Target).click(function () { selecttab(0); });
            $("#detaildiv", farmerWin.Target).click(function () { selecttab(1); });
            $("[id='imgpreviwe']", farmerWin.Target).mouseover(function () {
                $("[id='btons']", farmerWin.Target).css({ "opacity": "1" });
                $("[id='btnDel']", farmerWin.Target).css({ "opacity": "1" });
            }).mouseleave(function () {
                $("[id='btons']", farmerWin.Target).css({ "opacity": "0" });
                $("[id='btnDel']", farmerWin.Target).css({ "opacity": "0" });
            });
            $("[id='btons']", farmerWin.Target).mouseover(function () { $("[id='btons']", farmerWin.Target).css({ "opacity": "1" }); }).mouseleave(function () { $("[id='btons']", farmerWin.Target).css({ "opacity": "0" }); });
            $("[id='btnDel']", farmerWin.Target).mouseover(function () { $("[id='btnDel']", farmerWin.Target).css({ "opacity": "1" }); }).mouseleave(function () { $("[id='btnDel']", farmerWin.Target).css({ "opacity": "0" }); });
            //初始化下拉框数据
            var comboSex = $("#sex", farmerWin.Target).prop("$this");         //bin the dic
            var comboEducation = $("#education", farmerWin.Target).prop("$this");
            var comboPolitical = $("#political", farmerWin.Target).prop("$this");
            var comboHouseHold = $("#household", farmerWin.Target).prop("$this");
            var dicdata = Dev.GetDicData(["Sex", "Nation", "教育程度", "Political", "HkType"]);
            var dicS = Enumerable.From(dicdata).Where('s=>s.type=="Sex"').ToArray();
            var dicN = Enumerable.From(dicdata).Where('s=>s.type=="Nation"').ToArray();
            var nationcontrol = $("#nation", farmerWin.Target).prop("$this");
            nationcontrol.Target.prop("rawdata", dicN);
            nationDic = nationcontrol.Target.prop("rawdata");

            nationcontrol.SetData(dicN);
            nationcontrol.text.bind("onChange", function (e, s) {
                var filter = s.newValue;
                var filterdata = Enumerable.From(nationDic).Where('s=>s.data.indexOf("' + filter + '")>=0').ToArray();
                nationcontrol.SetData(filterdata);
                nationcontrol.Layout();
            });
            var dicE = Enumerable.From(dicdata).Where('s=>s.type=="教育程度"').OrderBy('s=>s.code').ToArray();
            var dicP = Enumerable.From(dicdata).Where('s=>s.type=="Political"').ToArray();
            var dicH = Enumerable.From(dicdata).Where('s=>s.type=="HkType"').ToArray();
            if (!Dev.IsNull(comboSex) && !Dev.IsNull(dicS)) { comboSex.SetData(dicS); comboSex.Layout(); }
            if (!Dev.IsNull(comboEducation) && !Dev.IsNull(dicE)) { comboEducation.SetData(dicE); comboEducation.Layout(); }
            if (!Dev.IsNull(comboPolitical) && !Dev.IsNull(dicP)) { comboPolitical.SetData(dicP); comboPolitical.Layout(); }
            if (!Dev.IsNull(comboHouseHold) && !Dev.IsNull(dicH)) { comboHouseHold.SetData(dicH); comboHouseHold.Layout(); }
        }
        //新增、修改页面初始化
        function initWindow(isUpdate) {
            var title = "农户新增";
            var cl = "user-usermanage";
            if (isUpdate) {
                title = "农户修改";
                cl = 'icon-featureupdate';
            }
            if (dev.IsNull(farmerWin)) {
                farmerWin = new Dev.Window({
                    ID: "farmerWin",
                    IconCls: cl,
                    Title: title,
                    Parent: Dev.App.FillPanel.Target,
                    Maximizable: false,
                    Modal: true,
                    Draggable: true,
                    HAlign: 'center',
                    VAlign: 'center',
                    Resizable: false,
                    Content: $(".MachineEdit"),
                    Height: 340,
                    Width: 540
                });
                //组织机构初始化
                initEwinParts();
            }
            else {      //窗体不为空时 的新增，例如 修改操作马上再进行 新增
                farmerWin.Open();
                farmerWin.SetTitle(title);
                farmerWin.SetIconCls(cl);
            }
            var selectnode = treeControl.GetSelectNode();
            comboTree.SetData(selectnode[0].$this);
            comboTree.Layout();
            initRegionsTree();          //初始化行政区划
            $("#name", farmerWin.Target).prop("$this").SetReadOnly(isUpdate);
            $("#name", farmerWin.Target).prop("$this").SetDisabled(isUpdate);

            $("#cardid", farmerWin.Target).prop("$this").SetReadOnly(isUpdate);
            $("#cardid", farmerWin.Target).prop("$this").SetDisabled(isUpdate);

            selecttab(0);
            if (isUpdate) loadupdate(row);
            farmerWin.bind("onClosing", function () {
                filePath = null;
                filePhoto = null;
                editClear();
                row = null;
                xzqControl = null;
            });
        }
        /*初始化行政区*/
        function initRegionsTree() {
            var isHighlight = true;
            xzqControl = $("#regionstree", $(".MachineEdit", Dev.App.FillPanel.Target));
            xzqControl.combotree({
                width: 149,
                height: 23,
                method: "post",
                url: Dev.GetSystemUrlByRelID("Service") + 'dictionary/asyncdata/canton',
                panelWidth: '149',
                onClick: function (node) {
                    xzqvlaues = {};
                    getselectvalue(node);
                    //if (node.data == "中国" || node.text == "中国") xzqControl.combotree("setText", "中国");        //选中“中国”时不显示 “中国”
                    //else xzqControl.combotree("setText", gettext());
                    return node.id;
                },
                onBeforeExpand: function (node, param) {
                    xzqControl.combotree('tree').tree('options').url = Dev.GetSystemUrlByRelID("Service") + 'dictionary/asyncdata/canton?id=' + node.id;
                },
                onLoadSuccess: function () {
                    $("li:eq(0)", $("#regionstree", $(".TaskWorkEdit", Dev.App.FillPanel.Target))).find("div").addClass("tree-node-selected");
                    var n = xzqControl.combotree('tree').tree("getSelected");
                    if (n != null) xzqControl.combotree('tree').tree("select", n.target);
                },
                loadFilter: function (data) {
                    data = data.data;
                    for (var i = 0; i < data.length; i++) {
                        if ('data' in data[i]) {
                            data[i].text = data[i].data;
                        }
                    }
                    return data;
                }
            });
        }
        function getselectvalue(node) {
            var type = node.remark;
            if (Dev.IsNull(type)) return;
            if (type == "省") type = "province";
            if (type == "市") type = "city";
            if (type == "县") type = "county";
            if (type == "镇") type = "town";
            if (type == "村") type = "village";
            xzqvlaues[type] = node.text;
            var parent = xzqControl.combotree("tree").tree("getParent", node.target);
            if (!Dev.IsNull(parent)) getselectvalue(parent);
        }
        function gettext() {
            if (Dev.IsNull(xzqvlaues)) return null;
            var text = "";
            if (!Dev.IsNull(xzqvlaues.province)) text += xzqvlaues.province + " ";
            if (!Dev.IsNull(xzqvlaues.city)) text += xzqvlaues.city + " ";
            if (!Dev.IsNull(xzqvlaues.county)) text += xzqvlaues.county + " ";
            if (!Dev.IsNull(xzqvlaues.town)) text += xzqvlaues.town + " ";
            if (!Dev.IsNull(xzqvlaues.village)) text += xzqvlaues.village + " ";
            return text;
        }
        function loadxzqnode(id) {
            var ajaxrequest = $.ajax({
                type: 'post',
                url: Dev.GetSystemUrlByRelID("Service") + '/dictionary/expandto/' + id,
                success: function (response) {
                    xzqControl.combotree("loadData", response);
                    xzqControl.combotree("setValue", id);
                    //xzqControl.combotree("setText", gettext());
                }
            });
            ajaxRequests.push(ajaxrequest);
        }
        //修改
        function update(id, index) {
            updateid = id;
            isUpdate = true;
            dataGrid.DataGrid.datagrid("selectRow", index);
            row = dataGrid.DataGrid.datagrid("getSelected");
            initWindow(true);
        }
        //加载数据
        function loadupdate(row) {
            if (Dev.IsNull(row) || row.length == 0) return;
            var textcontrol = $(".dev-textbox", farmerWin.Target);
            var combocontrol = $(".dev-combobox", farmerWin.Target);
            var numbercontrol = $(".dev-numberbox", farmerWin.Target);
            for (var i = 0; i < textcontrol.length; i++) {
                var tag = $(textcontrol[i]).attr("name");
                var currcontrol = $(textcontrol[i]).prop("$this");
                if (!Dev.IsNull(currcontrol)) currcontrol.SetValue(row[tag]);
            }
            for (var i = 0; i < numbercontrol.length; i++) {
                var tag = $(numbercontrol[i]).attr("name");
                var currcontrol = $(numbercontrol[i]).prop("$this");
                if (!Dev.IsNull(currcontrol)) currcontrol.SetValue(row[tag]);
            }
            for (var i = 0; i < combocontrol.length; i++) {
                var tag = $(combocontrol[i]).attr("name");
                var currcontrol = $(combocontrol[i]).prop("$this");
                if (!Dev.IsNull(currcontrol)) currcontrol.SetText(row[tag]);        //combobox  
            }
            if (!Dev.IsNull(row.regionsid)) loadxzqnode(row.regionsid);
            var selectnode = treeControl.GetSelectNode();
            comboTree.SetData(selectnode[0].$this);
            if (!Dev.IsNull(row.orgid)) comboTree.SetValueEx(row.orgid);
            //行政区
            xzqvlaues["province"] = row.province;
            xzqvlaues["city"] = row.city;
            xzqvlaues["county"] = row.county;
            xzqvlaues["town"] = row.town;
            xzqvlaues["village"] = row.village;
            if (!Dev.IsNull(row.attid))
                loadCrorPic(row.attid);
        }
        //加载附件表图片
        function loadCrorPic(attid) {
            var url = Dev.GetSystemUrlByRelID("Service") + "file/att/" + attid;
            $.ajax({
                url: url,
                type: "GET",
                contentType: 'application/json',
                success: function (result) {
                    if (result.statusCode != 200 || Dev.IsNull(result.data)) return;
                    var piclist = result.data;
                    if (Dev.IsNull(piclist) || piclist.length == 0) {
                        return;
                    }
                    $("#imgpreviwe", $(".MachineEdit", Dev.App.FillPanel.Target)).attr("src", piclist[0].path);
                }
            });
        }

        //删除
        function deleteinfo(index) {
            dataGrid.DataGrid.datagrid("selectRow", index);
            var rowD = dataGrid.DataGrid.datagrid("getSelected");
            var curRowNo = dataGrid.DataGrid.datagrid("getData").total;       //获取已有的数据行数
            if (curRowNo == 1 && pageIndex != 1) pageIndex -= 1;                //删光则返回上一页
            if (Dev.IsNull(rowD)) return;
            dialog.Confirm('该操作将会删除农户及其关联数据，确定执行？', function (r) {
                if (!r) return;
                var ajaxrequest = $.ajax({
                    type: "GET",
                    contentType: "application/json",
                    url: Dev.GetSystemUrlByRelID("Service") + "farmer/" + "delete/id/" + rowD.id,
                    success: function (response) {
                        if (!response.statusCode == 200) { flashDialog.Alert("删除失败!", "info"); return; };
                        flashDialog.Alert("删除成功!", "info");
                        search();
                    },
                    error: function (msg) {
                        flashDialog.Alert("删除失败!", "info");
                    }
                });
                ajaxRequests.push(ajaxrequest);
            }, "question");
        }
        //批量删除
        function deletes() {
            var rowsD = dataGrid.DataGrid.datagrid("getChecked");
            var curRowNo = dataGrid.DataGrid.datagrid("getData").total;       //获取已有的数据行数
            if (curRowNo == rowsD.length && pageIndex != 1) pageIndex -= 1;     //如果没删完，保持在本页，删完回到上一页。
            if (Dev.IsNull(rowsD) || rowsD.length == 0) {
                flashDialog.Alert("请选择需要删除的数据!", "info");
                return;
            }
            dialog.Confirm('该操作将会删除所有勾选农户及其关联数据，确定执行？', function (r) {
                if (!r) return;
                var ids = [];
                for (var i = 0; i < rowsD.length; i++) ids.push(rowsD[i].id);
                var ajaxrequest = $.ajax({
                    type: "POST",
                    data: ids.join(','),
                    contentType: "application/json",
                    url: Dev.GetSystemUrlByRelID("Service") + "farmer/deletes/ids",
                    success: function (response) {
                        if (!response.statusCode == 200) { flashDialog.Alert("删除失败!", "info"); return; };
                        flashDialog.Alert("删除成功!", "info");
                        search();
                    },
                    error: function (msg) {
                        flashDialog.Alert("删除失败!", "info");
                    }
                });
            }, "question");
        }
        function saveInfo() {
            var allmodel = {};
            var model = {};//农户信息
            var file = {};//附件信息
            var mydate = new Date();
            model.updatedate = mydate;      //新增 updatedate初始化为新增时间，修改时保存这里updatedate也为这个时间
            if (isUpdate) { model.id = updateid; model.attid = row.attid }
            else model.createdate = mydate;
            var textControl = $(".dev-textbox", farmerWin);
            var comboControl = $(".dev-combobox", farmerWin);
            var numberControl = $(".dev-numberbox", farmerWin);
            for (var i = 0; i < textControl.length; i++) {
                var tag = $(textControl[i]).attr("name");
                var value = $(textControl[i]).prop("$this").GetValue().trim();
                if (tag == "cardid") value = value.toUpperCase();
                model[tag] = value;
            }
            for (var i = 0; i < comboControl.length; i++) {
                var tag = $(comboControl[i]).attr("name");
                var value = $(comboControl[i]).prop("$this").GetText();
                model[tag] = value;
            }
            for (var i = 0; i < numberControl.length; i++) {
                var tag = $(numberControl[i]).attr("name");
                var value = $(numberControl[i]).prop("$this").GetValue();
                model[tag] = value;
            }
            model.orgid = comboTree.GetValue();     //根据Select选项获取orgid
            model.regionsid = xzqControl.combotree("getValue");
            model.province = xzqvlaues.province;
            model.city = xzqvlaues.city;
            model.county = xzqvlaues.county;
            model.town = xzqvlaues.town;
            model.village = xzqvlaues.village;
            //model.photouri = filePath;
            allmodel.farmer = model;
            allmodel.file = filePhoto;
            var isok = verify(model);            //验证
            if (!isok) return;
            var ajaxrequest = $.ajax({
                type: "POST",
                data: JSON.stringify(allmodel),
                contentType: 'application/json',
                url: Dev.GetSystemUrlByRelID("Service") + "farmer/" + (isUpdate ? "updateFarmer" : "addFarmer"),
                success: function (response) {
                    if (response.statusCode == 200) {
                        updateid = null;        //防止修改再进行新增出现的逻辑错误
                        searchClear();               //当查询条件不为空，且非第一页展示的情况下 新增
                        farmerWin.Close();
                        pageIndex = 1;          //要马上跳转到第一页
                        search();                   //而且 清空查询条件进行刷新显示
                        flashDialog.Alert((isUpdate ? "修改成功!" : "新增成功!"), "info");
                    }
                },
                error: function (e) {
                    flashDialog.Alert(msg.OperationFailed, "error");
                }
            });
            ajaxRequests.push(ajaxrequest);
        }
        function verify(model) {
            var errorMsg = $("#errorMsg", $(".MachineEdit", Dev.App.FillPanel.Target));
            errorMsg.html("");
            if (Dev.IsNull(model.name)) { errorMsg.html("\“姓名\”不能为空！"); return false }
            if (model.name.length > 10) { errorMsg.html("\“姓名\”长度过长！"); return false; }
            //电话有效性验证
            if (Dev.IsNull(model.mobilephone)) { errorMsg.html("\“电话号码\”不能为空！"); return false; }
            else {
                var mp = Dev.validation("mobilephone", model.mobilephone);
                var fmp = Dev.validation("tel", model.mobilephone);
                if (!mp.isvalid && !fmp.isvalid) { errorMsg.html("\“电话号码\”无效!"); return false; }
            }
            if (Dev.IsNull(model.orgid)) { errorMsg.html("\“组织机构\”不能为空！"); return false; }
            //身份证号有效性验证
            if (Dev.IsNull(model.cardid)) { errorMsg.html("\“身份证号\”不能为空！"); return false; }
            else {
                var isUnique = true;
                if (!isUpdate) {         //唯一性检查
                    var ajaxrequest = $.ajax({
                        type: "GET",
                        async: false,
                        contentType: "application/json",
                        url: Dev.GetSystemUrlByRelID("Service") + "farmer/getbyfilter/ \"CARDID\" =\'" + model.cardid + "\' and \"ID\"!=\'" + updateid + "\'",
                        success: function (result) {
                            if (result.statusCode == 200 && result.data.length !== 0) {
                                isUnique = false;
                                errorMsg.html("\“身份证号\”已经存在！");
                            }
                        }
                    });
                    ajaxRequests.push(ajaxrequest);
                    if (!isUnique) return false;
                }
                var cardid = Dev.validation("IDcard", model.cardid);
                if (!cardid.isvalid) { errorMsg.html(cardid.Msg); return false; }
            }
            if (Dev.IsNull(model.bankcard)) { errorMsg.html("\“银行卡号\”不能为空！"); return false; }
            else {
                var mb = Dev.validation("bankcard", model.bankcard);
                if (!mb.isvalid) { errorMsg.html(mb.Msg); return false; }
            }
            if (Dev.IsNull(model.regionsid)) { errorMsg.html("\“地区\”不能为空！"); return false; }
            else { if (Dev.IsNull(model.county)) { errorMsg.html("\“地区\”未到县级，请重新选择！"); return false; } }
            if (Dev.IsNull(model.cultivated)) { errorMsg.html("\“耕地面积\”不能为空！"); return false; }
            if (model.cultivated > 99999) { errorMsg.html("\“耕地面积\”不合理！"); return false; }
            if (!Dev.IsNull(model.nation)) {
                var nationlist = Enumerable.From(nationDic).Select("s=>s.data").ToArray();
                if (nationlist.indexOf(model.nation) == -1) { errorMsg.html("请输入正确的\“民族\”"); return false; }
            }
            if (model.domicile.length > 10) { errorMsg.html("\“户籍地\”长度过长！"); return false; }
            if (model.address.length > 60) { errorMsg.html("\“详细地址\”长度过长！"); return false; }
            if (model.remark.length > 120) { errorMsg.html("\“详细地址\”长度过长！"); return false; }
            return true;
        }
        function uploadPhoto(dom, id) {
            var file;
            var preview = $("#imgpreviwe", $(".MachineEdit", Dev.App.FillPanel.Target));
            if (dom.files.length == 0) return;
            file = dom.files[0];
            if (!checkType(file.name)) {
                $("input[name='devfile']", $(".MachineEdit", Dev.App.FillPanel.Target)).each(function () {
                    $(this).val("");
                })
                return;
            }
            if (file.size > 102400000) {
                flashDialog.Alert("文件最大为100M", "error");
                return;
            }
            var form = new FormData();
            form.append("devfile", file);
            var ajaxrequest = $.ajax({
                type: 'post',
                url: Dev.cookie.baseUri + "file/upload",
                data: form,
                contentType: false,
                processData: false,
                success: function (response) {
                    if (!Dev.IsNull(response) && response.statusCode == 200) {
                        filePhoto = response.data[0];
                        var fp = response.data[0].path;
                        if (!Dev.IsNull(fp)) {
                            filePath = fp;
                            preview.attr("src", response.data[0].path);
                        }
                    }
                },
                error: function (e) {
                    flashDialog.Alert(msg.netout, "error");
                }
            });
            ajaxRequests.push(ajaxrequest);
            return true;
        }        //预览图片
        function checkType(image) {
            var extStart = image.lastIndexOf(".");
            var ext = image.substring(extStart, image.length).toUpperCase();
            if (ext != ".PNG" && ext != ".GIF" && ext != ".JPG" && ext != ".JPEG") {
                flashDialog.Alert("图片限于png，gif，jpeg，jpg格式！", "error");
                return false;
            }
            return true;
        }        /*检测照片格式*/
        //辅助函数
        function getCondition() {
            var condition = "1=1";
            var nameControl = $("#searchName").prop("$this");
            if (!Dev.IsNull(nameControl)) {
                var name = nameControl.GetValue();
                if (!Dev.IsNull(name) && name.length > 0) condition += " AND ( \"NAME\"  LIKE '%" + $.trim(name) + "%'" + " OR " + "UPPER( \"NAME\" )  LIKE " + "UPPER('%" + $.trim(name) + "%')" + " OR " + "LOWER( \"NAME\" )  LIKE " + "LOWER('%" + $.trim(name) + "%'))";
            }
            var cardIDControl = $("#searchCD").prop("$this");
            if (!Dev.IsNull(cardIDControl)) {
                var cd = cardIDControl.GetValue();
                if (!Dev.IsNull(cd) && cd.length > 0) condition += " AND (UPPER ( \"CARDID\" ) LIKE '%" + $.trim(cd) + "%' OR LOWER ( \"CARDID\") LIKE '%" + $.trim(cd) + "%')";
            }
            var time1 = $("#uploadtime1").datebox("getValue");
            var time2 = $("#uploadtime2").datebox("getValue");
            if (!Dev.IsNull(time1) && !Dev.IsNull(time2)) {
                var t1 = new Date(time1.replace(/-/g, "/"));
                var t2 = new Date(time2.replace(/-/g, "/"));
                if (t1.getTime() > t2.getTime()) {
                    var temp = time1;
                    time1 = time2;
                    time2 = temp;
                }
            }
            if (!Dev.IsNull(time1)) condition += " AND \"CREATEDATE\">='" + time1 + " 00:00:00'";
            if (!Dev.IsNull(time2)) condition += " AND \"CREATEDATE\"<='" + time2 + " 23:59:59'";
            if (!dev.IsNull(orgFilter)) condition += " AND  " + orgFilter;
            condition += "ORDER BY  \"UPDATEDATE\"" + "DESC";
            return condition;
        }//查询条件
        function selecttab(index) {
            if (index === 0) {
                $("#basicdiv", farmerWin.Target).css({ "background-color": "transparent", "border-left": '0px', "border-right": '0px' });
                $("#detaildiv", farmerWin.Target).css({ "background-color": "#CCCCCC", "border-left": 'solid 1px #999999', "border-right": 'solid 1px #CCCCCC', "border-bottom": '0px' });
                $("#loginInfo", farmerWin.Target).css({ "display": 'block' });
                $("#allInfo", farmerWin.Target).css({ "display": 'none' });
            }
            if (index === 1) {
                $("#detaildiv", farmerWin.Target).css({ "background-color": "transparent", "border-right": '0px' });
                $("#basicdiv", farmerWin.Target).css({ "background-color": "#CCCCCC", "border-right": 'solid 1px #999999', "border-bottom": '0px' });
                $("#allInfo", farmerWin.Target).css({ "display": 'block' });
                $("#loginInfo", farmerWin.Target).css({ "display": 'none' });
            }
        } //tab切换
        function deletePhoto() {
            $("[id^='imgpreviwe']", $(".MachineEdit", Dev.App.FillPanel.Target)).each(function () {
                $(this).attr("src", "image/authorization/default.jpg");
            });     //恢复为默认头像
            filePath = "";
        }       //删除头像
        function searchClear() {
            $("#searchName", $("#searchDiv")).prop("$this").Clear();
            $("#searchCD", $("#searchDiv")).prop("$this").Clear();
            $("#uploadtime1", $("#searchDiv")).datebox("setValue", "");
            $("#uploadtime2", $("#searchDiv")).datebox("setValue", "");
        }
        function editClear() {
            var textcontrol = $(".dev-textbox", $(".MachineEdit", Dev.App.FillPanel.Target));
            var numbercontrol = $(".dev-numberbox", $(".MachineEdit", Dev.App.FillPanel.Target));
            var comboboxcontrol = $(".dev-combobox", $(".MachineEdit", Dev.App.FillPanel.Target));
            var errorMsg = $("#errorMsg", $(".MachineEdit", Dev.App.FillPanel.Target));
            errorMsg.html("");
            for (var i = 0; i < textcontrol.length; i++) {
                var currcontrol = $(textcontrol[i]).prop("$this");
                currcontrol.Clear();
                if (!Dev.IsNull(currcontrol.SetLengthTip)) currcontrol.SetLengthTip("");
            }
            for (var i = 0; i < numbercontrol.length; i++) { var currcontrol = $(numbercontrol[i]).prop("$this"); currcontrol.Clear(); }
            for (var i = 0; i < comboboxcontrol.length; i++) { var currcontrol = $(comboboxcontrol[i]).prop("$this"); currcontrol.SetValue(""); }
            $("[id^='imgpreviwe']", $(".MachineEdit", Dev.App.FillPanel.Target)).each(function () {
                $(this).attr("src", "image/authorization/default.jpg");
            });
            $("input[name='devfile']", $(".MachineEdit", Dev.App.FillPanel.Target)).each(function () {
                $(this).val("");
            })
            if (!Dev.IsNull(xzqControl)) {
                xzqControl.combotree("tree").tree("collapseAll");//折叠所有节点
                xzqControl.combotree("hidePanel");//隐藏下拉面板
                xzqControl.combotree("clear");//清空值
            }
        }
        function loadError() {
            if (!Dev.IsNull(dataGrid)) dataGrid.Load([], { totalCount: 0, pageIndex: pageIndex, pageSize: pageSize, pageCount: 0 });
        }
        function resize() {
            // Dev.App.BottomPanel.SetHeight(262);
            var height = $(window).outerHeight();
            treeControl.SetHeight(height == 0 ? (262 - 26) : (height - 26));

            var gridheight = height - 40;
            var gridwidth = parseInt($(window).width() * 0.80) - 2;
            if (gridwidth < 1200) {
                gridwidth = 1200;
                gridheight = parseInt(gridheight) - 16;
            }
            $("#searchDiv").width(gridwidth);
            $("#gridDiv").height(gridheight).width(gridwidth);
            if (!Dev.IsNull(dataGrid)) dataGrid.Resize(gridwidth, gridheight);
        }
    </script>
</head>
<body>
    <div id="content" class="content">
        <div style="height: 100%; width: 20%; position: absolute;">
            <!-- <div style="height: 26px; line-height: 26px; width: 100%; background-color: #ddd;">
                <span style="margin-left: 15px; color: #0099cc; line-height: 26px; letter-spacing: 3px; font-size: 12px;">组织机构</span>
            </div>-->
            <div id="treediv" style="width: 100%; height: 100%;">
                <div class="dev-tree" opt='{"ValueField":"id","TextField":"name","ChildrenField":"child","Height":220}'>
                </div>
            </div>
        </div>
        <div style="height: 100%; width: 80%; position: absolute; left: 20%; overflow: auto; overflow-y: hidden">
            <div id="searchDiv" style="height: 38px; border-left: 1px solid #ddd; position: relative; min-width: 1200px;">
                <div style="height: 38px; position: absolute; left: 0px;">
                    <div class="SearchDiv">
                        <div id="searchName" class="dev-textbox" style="width: 200px; display: inline-block;"
                            opt='{"TipInfo":"","HeaderCSS":{"padding":"0px","width":"75px"},"IsOverShow":true,"Padding":"0px 5px","TextAlign":"left","BodyCSS": { "background-color": "transparent","margin-top":"8px","margin-left":"5px" },"Title":"<div class=\"Title\"><div class=\"Icon user-username\"></div><span class=\"Text\" style=\"width:35px\">姓名</span></div>"}'>
                        </div>
                    </div>
                    <div class="SearchDiv">
                        <div id="searchCD" class="dev-textbox" style="width: 200px; display: inline-block;"
                            opt='{"TipInfo":"","HeaderCSS":{"padding":"0px","width":"75px"},"IsOverShow":true,"Padding":"0px 5px","TextAlign":"left","BodyCSS": { "background-color": "transparent","margin-top":"8px","margin-left":"5px" },"Title":"<div class=\"Title\"><div class=\"Icon machine-name\" style=\"float:left;margin-left:3px\"></div><span class=\"Text\" style=\"width:50px\">身份证号</span></div>"}'>
                        </div>
                    </div>
                    <div class="SearchDiv" style="width: 209px;">
                        <div style="width: 75px; height: 38px; line-height: 38px; text-align: right; display: inline-block; float: left;">
                            <div class="icon-calendar"
                                style="height: 16px; width: 16px; display: inline-block; float: left; margin-left: 5px; margin-top: 11px;">
                            </div>
                            <span style="height: 40px; line-height: 40px; width: 49px; float: right;">创建时间</span>
                        </div>
                        <div style="width: 120px; height: 40px; line-height: 38px; padding: 0px 5px; display: inline-block; float: left; margin-top: 0px; margin-left: 3px">
                            <input id="uploadtime1" class="easyui-datebox"
                                data-options="width:120,height:24,editable:false" />
                        </div>
                    </div>
                    <div class="SearchDiv">
                        <div style="width: 16px; height: 38px; display: inline-block; line-height: 40px; text-align: center; float: left;">
                            至
                        </div>
                        <div style="width: 120px; height: 38px; line-height: 38px; padding: 0px 5px; display: inline-block; float: left; margin-top: 0px;">
                            <input id="uploadtime2" class="easyui-datebox"
                                data-options="editable:false,width:120,height:24" />
                        </div>
                    </div>
                </div>
                <div style="width: 180px; height: 100%; position: absolute; right: 11px; z-index: 2; top: -2px;" class="button_div">
                    <div class="Button" tag="search" style="margin-left: 10px;">
                        <div class="machine-query" style="height: 16px; width: 16px; margin-top: 4px; margin-left: 5px; display: inline-block; float: left;"></div>
                        <span style="line-height: 28px; color: #fcfcfc;">查&nbsp;询</span>
                    </div>
                    <div class="Button" tag="clear">
                        <div class="machine-reset" style="height: 16px; width: 16px; margin-top: 4px; margin-left: 5px; display: inline-block; float: left;"></div>
                        <span style="line-height: 28px; color: #fcfcfc;">重&nbsp;置</span>
                    </div>
                    <div class="Button ButtonDisplay" tag="add">
                        <div class="machine-add" style="height: 16px; width: 16px; margin-top: 4px; margin-left: 5px; display: inline-block; float: left;"></div>
                        <span style="line-height: 28px; color: #fcfcfc;">新&nbsp;增</span>
                    </div>
                    <div class="Button ButtonDisplay" tag="deletes" style="width: 75px;">
                        <div class="machine-deletes" style="height: 16px; width: 16px; margin-top: 4px; margin-left: 5px; display: inline-block; float: left;"></div>
                        <span style="line-height: 28px; color: #fcfcfc;">批量删除</span>
                    </div>
                </div>
            </div>
            <div id="gridDiv" style="border-left: 1px solid #ddd; border-top: 1px solid #ddd;"></div>
        </div>
    </div>
    <div class="MachineEdit" style="height: 305px">
        <div id="tabinfo" style="width: 100%; height: auto; position: absolute">
            <div style="height: 26px; width: 540px; background: #E0E0E0; position: absolute; border-bottom: 1px solid  #E0E0E0">
                <div id="basicdiv" style="position: absolute; height: 27px; width: 270px; text-align: center; background-color: #fff; border-right: solid 1px #999999"><span style="line-height: 26px; cursor: pointer">基础信息</span></div>
                <div id="detaildiv" style="position: absolute; height: 27px; width: 270px; left: 270px; text-align: center;"><span style="line-height: 26px; cursor: pointer">详细信息</span></div>
            </div>
            <div id="loginInfo" style="width: 540px; position: absolute; top: 31px; display: block; z-index: 2;">
                <div class="Row" style="width: 240px">
                    <div class="Cell">
                        <div id="name" class="dev-textbox" name="name" style="width: 239px; height: 24px; margin-top: 6px;" opt='{"MaxLength":10,"Required":true,"TipInfo":"10位以内","HeaderCSS":{"padding":"0px 5px","width":"80px", "text-align": "RIGHT"},"IsOverShow":true,"Padding":"0px 5px","Title":"<div class=\"Title\"><span>姓名</span></div>"}'>
                        </div>
                    </div>
                </div>
                <div class="Row" style="width: 240px">
                    <div class="Cell" style="width: 270px">
                        <div style="width: 85px; height: 100%; line-height: 35px; text-align: right; padding-right: 5px; float: left; z-index: 2;">选择组织</div>
                        <div id="treecomboDiv" style="z-index: 1; height: 20px; width: 149px; margin-top: 5px; float: left;"></div>
                    </div>
                </div>
                <div class="Row" style="width: 240px">
                    <div class="Cell">
                        <div class="dev-textbox" name="mobilephone" style="width: 239px; height: 24px; margin-top: 6px;" maxlength="64" opt='{"MaxLength":16,"Required":true, "TipInfo":"16位以内",  "HeaderCSS":{"padding":"0px 5px","width":"80px"},"Padding":"0px 5px","Title":"<div class=\"Title\"><span>电话号码</div>"}'></div>
                    </div>
                </div>
                <div class="Row" style="width: 240px">
                    <div class="Cell">
                        <div id="cardid" class="dev-textbox" name="cardid" style="width: 239px; height: 24px; margin-top: 6px;" maxlength="64" opt='{"MaxLength":36,"Required":true, "TipInfo":"36位以内",  "HeaderCSS":{"padding":"0px 5px","width":"80px"},"Padding":"0px 5px","Title":"<div class=\"Title\"><span>身份证号</div>"}'></div>
                    </div>
                </div>
                <div class="Row" style="width: 240px">
                    <div class="Cell" style="width: 270px">
                        <div class="dev-textbox" name="bankcard" style="width: 239px; height: 24px; margin-top: 6px;" maxlength="64" opt='{"MaxLength":36,"Required":true, "TipInfo":"36位以内",  "HeaderCSS":{"padding":"0px 5px","width":"80px"},"Padding":"0px 5px","Title":"<div class=\"Title\"><span>银行卡号</div>"}'></div>
                    </div>
                </div>
                <div class="Row" style="width: 540px">
                    <div class="Cell" style="width: 270px">
                        <div style="width: 85px; height: 100%; line-height: 35px; text-align: right; padding-right: 5px; float: left">
                            地区
                        </div>
                        <div style="height: 270px; line-height: 35px; text-align: right; float: left">
                            <div id="regionstree"></div>
                            <div style="position: relative; height: 10px; width: 10px; top: -21px; left: 120px; color: red; line-height: 10px;">*</div>
                        </div>
                    </div>
                    <div class="Cell">
                        <div class="dev-numberbox" name="cultivated" style="width: 239px; height: 24px; margin-top: 6px;" maxlength="64" opt='{"MaxLength":5,"Required":true,"Precision":2,"Min":0,"TipInfo":"5位以内",  "HeaderCSS":{"padding":"0px 5px","width":"80px"},"Padding":"0px 5px","Title":"<div class=\"Title\"><span>耕地面积(亩)</div>"}'></div>
                    </div>
                </div>
                <div style="margin-top: -180px; margin-left: 300px; border: solid 1px #aec9eb; height: 130px; width: 120px; float: left; position: absolute;">
                    <span style="width: 50px; position: absolute; top: -25px; left: 30px">用户头像</span>
                    <img id="imgpreviwe" src="image/authorization/default.jpg"
                        style="width: 120px; height: 130px; position: absolute; top: 0px;" />
                    <div id="btons"
                        style="position: absolute; width: 120px; background-color: rgba(0,0,0,0.4); opacity: 0; height: 25px; text-align: center; line-height: 25px; z-index: 10; bottom: 0px; cursor: pointer;">
                        <span style="color: white; width: 58px; cursor: pointer;">选择图片</span>
                        <div style="filter: alpha(opacity=0); opacity: 0; position: absolute; width: 120px; bottom: 0px; cursor: hand;">
                            <input
                                type="file" name="devfile" id="photo" accept="image/png,image/gif,image/jpg,image/jpeg" style="cursor: pointer; width: 120px;" />
                        </div>
                    </div>
                    <div id="btnDel" title="点击删除头像" style="position: absolute; width: 15px; height: 15px; background-color: #ddd; opacity: 0; text-align: center; line-height: 17px; z-index: 10; cursor: pointer; right: 0px;">
                        <span style="color: white; cursor: pointer;">&Chi;</span>
                    </div>
                    <span style="position: absolute; top: 0px; width: 80px; left: 130px; color: grey">1、支持PNG、GIF、BMP、JPG/JPEG格式,文件小于4M；</span>
                    <span style="position: absolute; top: 60px; width: 80px; left: 130px; color: grey">2、上传的图片会生成小尺寸，请注意小尺寸的头像是否清晰。</span>
                </div>
            </div>
            <div id="allInfo" style="position: absolute; top: 30px; display: none">
                <div class="Row">
                    <div class="Cell" style="width: 270px">
                        <div id="sex" class="dev-combobox" name="sex" style="width: 239px; margin-top: 5px;" opt='{"TextField":"data","ValueField":"id","TipInfo":"请选择","HeaderCSS":{"padding":"0px 5px","width":"80px", "text-align": "RIGHT"},"IsOverShow":true,"Padding":"0px 5px","TextAlign":"left","BodyCSS": { "background-color": "transparent" },"Title":"<div class=\"Title\"><span>性别</span></div>"}'>
                        </div>
                    </div>
                    <div class="Cell" style="width: 270px">
                        <div id="nation" class="dev-combobox" name="nation"
                            style="width: 239px; margin-top: 5px;"
                            opt='{"Readonly":false,"PopupHeight":"auto","TextField":"data","ValueField":"id","TipInfo":"请选择","HeaderCSS":{"padding":"0px 5px","width":"80px", "text-align": "RIGHT"},"IsOverShow":true,"Padding":"0px 5px","TextAlign":"left","BodyCSS": { "background-color": "transparent" },"Title":"<div class=\"Title\"><span>民族</span></div>"}'>
                        </div>
                        <!--<input class="easyui-combobox" name="nation" id="nation"/>-->
                    </div>
                </div>
                <div class="Row">
                    <div class="Cell" style="width: 270px">
                        <div id="household" class="dev-combobox" name="household"
                            style="width: 239px; margin-top: 5px;"
                            opt='{"TextField":"data","ValueField":"id","TipInfo":"请选择","HeaderCSS":{"padding":"0px 5px","width":"80px", "text-align": "RIGHT"},"IsOverShow":true,"Padding":"0px 5px","TextAlign":"left","BodyCSS": { "background-color": "transparent" },"Title":"<div class=\"Title\"><span>户口性质</span></div>"}'>
                        </div>
                    </div>

                    <div class="Cell" style="width: 270px">
                        <div class="dev-textbox" name="domicile" style="width: 239px; height: 24px; margin-top: 6px;" maxlength="64" opt='{"MaxLength":10,"TipInfo":"10位以内",  "HeaderCSS":{"padding":"0px 5px","width":"80px"},"Padding":"0px 5px","Title":"<div class=\"Title\"><span>户籍地</div>"}'></div>
                    </div>
                </div>
                <div class="Row">
                    <div class="Cell" style="width: 270px">
                        <div id="education" class="dev-combobox" name="education"
                            style="width: 239px; margin-top: 5px;"
                            opt='{"PopupHeight":150,"TextField":"data","ValueField":"id","TipInfo":"请选择","HeaderCSS":{"padding":"0px 5px","width":"80px", "text-align": "RIGHT"},"IsOverShow":true,"Padding":"0px 5px","TextAlign":"left","BodyCSS": { "background-color": "transparent" },"Title":"<div class=\"Title\"><span>文化程度</span></div>"}'>
                        </div>
                    </div>
                    <div class="Cell" style="width: 270px">
                        <div id="political" class="dev-combobox" name="political"
                            style="width: 239px; margin-top: 5px;"
                            opt='{"PopupHeight":150,"TextField":"data","ValueField":"id","TipInfo":"请选择","HeaderCSS":{"padding":"0px 5px","width":"80px", "text-align": "RIGHT"},"IsOverShow":true,"Padding":"0px 5px","TextAlign":"left","BodyCSS": { "background-color": "transparent" },"Title":"<div class=\"Title\"><span>政治面貌</span></div>"}'>
                        </div>
                    </div>
                </div>
                <div class="Row" style="height: 35px; width: 540px; border-bottom: 1px solid #ddd;">
                    <div class="Cell" style="height: 35px; width: 486px;">
                        <div style="height: 24px; width: 486px; display: inline-block; float: left;">
                            <div class="dev-textbox" name="address" style="width: 509px; height: 24px; margin-top: 6px;" opt='{"MaxLength":60,"TipInfo":"60位以内","HeaderCSS":{"padding":"0px 5px","width":"80px", "text-align": "RIGHT"},"IsOverShow":true,"Padding":"0px 5px","Title":"<div class=\"Title\"><span>详细地址</span></div>"}'>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="Row" style="height: 79px; width: 540px; border-bottom: 1px solid #ddd;">
                    <div class="Cell" style="height: 79px; width: 488px;">
                        <div class="dev-textbox" name="remark" style="width: 509px; height: 69px; margin-top: 6px;" maxlength='256' opt='{"MaxLength":120,"TipInfo":"120位以内","Type":"multi-text","HeaderCSS":{"padding":"0px 5px","width":"80px"},"IsOverShow":true,"Padding":"0px 5px","Title":"<div class=\"Title\">备注</div>"}'></div>
                    </div>
                </div>
            </div>
        </div>
        <div id="errorMsg"
            style="height: 35px; width: 300px; line-height: 35px; color: red; padding-left: 10px; margin-left: 20px; margin-top: 260px; display: inline-block">
        </div>
        <div class="Submit" style="margin-right: -10px; margin-top: 257px">
            <div class="Button" tag="save">
                <span style="line-height: 26px; color: #fcfcfc;">保&nbsp;&nbsp;存</span>
            </div>
            <div class="Button" tag="cancel">
                <span style="line-height: 26px; color: #fcfcfc;">取&nbsp;&nbsp;消</span>
            </div>
        </div>
    </div>
</body>
</html>
