<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>农户详细详细</title>
    <link rel="stylesheet" type="text/css" href="../../theme/icon.css" />
    <link rel="stylesheet" type="text/css" href="../../css/app.css" />
    <link rel="stylesheet" type="text/css" href="../../css/main.css" />
    <link rel="stylesheet" type="text/css" href="../../css/icon.css" />
    <link type="text/css" href="../../css/dev.css" rel="stylesheet" />
    <script type="text/javascript" src="../../js/jquery.min.js"></script>
    <script type="text/javascript" src="../../js/jquery.easyui.min.js"></script>
    <script type="text/javascript" src="../../js/easyui-lang-zh_CN.js"></script>
    <script type="text/javascript" src="../../js/linq.min.js"></script>
    <script type="text/javascript" src="../../js/data.util.js"></script>
    <script type="text/javascript" src="../../js/jquery.dev.control.js"></script>
    <style type="text/css">
        .basicInfo {
            height: 277px;
            width: 600px;
            position: relative;
        }

            .basicInfo .info {
                height: 215px;
                width: 600px;
                border-bottom: 1px dashed #ddd;
            }

                .basicInfo .info .leftinfo {
                    height: 215px;
                    width: 383px;
                    display: inline-block;
                    float: left;
                }

                    .basicInfo .info .leftinfo .item {
                        height: 35px;
                        width: 191px;
                        border-bottom: 1px dashed #ddd;
                        display: inline-block;
                        float: left;
                    }

                        .basicInfo .info .leftinfo .item .title {
                            width: 65px;
                            height: 35px;
                            padding-right: 5px;
                            text-align: right;
                            display: inline-block;
                            float: left;
                            line-height: 35px;
                        }

                        .basicInfo .info .leftinfo .item .value {
                            width: 115px;
                            height: 35px;
                            padding-left: 5px;
                            display: inline-block;
                            line-height: 35px;
                            overflow-x: hidden;
                            overflow-y: auto;
                        }

        .detail {
            width: 144px;
            height: 29px;
            text-align: center;
            display: inline-block;
            border-bottom: 1px dashed #ddd;
            line-height: 29px;
            float: left;
        }

        .row {
        }

            .row:hover {
                background-color: #FFE48D;
            }

        .part {
            border-right: 1px dashed #ddd;
        }

        .select {
            background-color: #FFE48D;
        }

        .rightAlign {
            text-align: right;
            padding-right: 5px;
        }

        .leftAlign {
            text-align: left;
            padding-left: 5px;
        }

        .setoverflow {
            overflow-x: hidden;
            overflow-y: auto;
        }
    </style>
    <script type="text/javascript">
        var Dev = window.top.window.dev;
        var parent, farmerid;
        var tabControl;
        var isadmin;
        function WidgetCommunication(s) {//部件通讯
            parent = s.parent;
            farmerid = s.param.farmerId;
            isadmin = (Dev.cookie.user.posts[0].postowner == 1 && Dev.cookie.user.posts[0].mainpost == 1);
            //初始化tab
            $(".title").css("color", "grey");
            initTab();
            getFarmer();
            getmassif();
        }
        function initTab() {
            $("#farmercontent").empty();
            var items = [{ ID: "fbasicInfo", Name: "基础信息", Content: $(".basicInfo"), Width: 600, Height: 400 }, { ID: "fmassinfo", Name: "关联地块", Content: $('#massinfo'), Width: 600, Height: 400 }];
            tabControl = new Dev.Tab({
                ID: "farmerTab",
                Width: 600,
                Height: 400,
                TabNormalCls: "liveNormalTabCls",
                TabSelectedCls: "liveSelectedTabCls",
                Items: items
            });
            tabControl.bind("onSelected", function () { });
            $("#farmercontent").append(tabControl.Target);
            tabControl.Layout();
        }
        //获取当前数据
        function getFarmer() {
            $.ajax({
                type: "get",
                url: Dev.cookie.baseUri + "farmer/qorg/" + farmerid + "?" + new Date().getTime(),
                success: function (response) {
                    loadFarmer(response.data);
                }
            });
        }
        function loadFarmer(data) {
            if (Dev.IsNull(data)) return;
            $.each(data, function (e, o) {
                var curr = $('div[name="' + e + '"]', $(".basicInfo"));
                var isencryp = curr.attr("tag");
                var slen=curr.attr("slen");
                var elen=curr.attr("elen");
                if (!Dev.IsNull(curr) && curr.length > 0) {
                    if (e == "cultivated") o = o + "(亩)";
                    if (!isadmin && !Dev.IsNull(isencryp)) o = Dev.simpleencryp(o, parseInt(slen), parseInt(elen));//如果不是岗位管理员则需要简易加密
                    curr.html(o);
                }
            });
            //显示行政区
            var xzq = "";
            if (!Dev.IsNullAll(data.province)) xzq += data.province + " ";
            if (!Dev.IsNullAll(data.city)) xzq += data.city + " ";
            if (!Dev.IsNullAll(data.county)) xzq += data.county + " ";
            if (!Dev.IsNullAll(data.town)) xzq += data.town + " ";
            if (!Dev.IsNullAll(data.village)) xzq += data.village + " ";
            $("div[name='xzqtext'").html(xzq);
            if (!Dev.IsNull(data.photouri)) $("div[name='imgsview']").css("background-image", "url('" + data.photouri + "')");
        }
        var box;
        function getlinkblocklist(data) {
            var massinfo = $("#massinfo");
            var div = $('<div></div>');
            if (!Dev.IsNull(data) && data.length > 0) {
                for (var i = 0; i < data.length; i++) {
                    if (i == 0) var row = $(".row").attr("id", "COPY" + i);
                    var row = $(".row").clone().attr("id", "COPY" + i);
                    var childs = row.children();
                    for (var j = 0; j < childs.length; j++) {
                        if ($(childs[j]).attr("name") == "farmlandarea") $(childs[j]).html(Dev.SqrtMetersToMu(data[i][$(childs[j]).attr("name")]));
                        else $(childs[j]).html(data[i][$(childs[j]).attr("name")]);
                    }
                    div.append(row);
                }
            }
            if (Dev.IsNull(box)) {
                box = new Dev.Box({ HasBorder: false, Width: 600, Height: 132 });
            }
            box.SetContent(div);
            box.SetHeight(132);
            massinfo.append($("#massHead"));
            massinfo.append(box.Target);
            //box.Layout();
            for (var i = 0; i < data.length; i++) {         //增加到 html后，才能行驶绑定函数
                var rid = "#" + "COPY" + i;
                $(rid).prop("data", data[i]);
                $(rid).bind("click", function () {
                    //$(this).css('background-color', '#ddd');
                    $('.row').removeClass("select");
                    $(this).addClass("select");
                    var rowdata = $(this).prop("data");
                    binddata(rowdata);
                    massinfo.append($("#massinfodetail"));
                });
            }
        }

        //绑定 地块详细信息
        function binddata(data) {
            $("#massifid").html(data["massifid"]);
            $("#classname").html(data["classname"]);
            $("#ownership").html(data["ownership"]);
            $("#ownershipname").html(data["ownershipname"]);
            $("#landtype").html(data["landtype"]);
            $("#farmlandtype").html(data["farmlandtype"]);
            $("#farmlandarea").html(Dev.SqrtMetersToMu(data["farmlandarea"]) + "(亩)");
            $("#remark").html(data["remark"]);
            $("#region").html((Dev.IsNull(data["province"]) ? "" : data["province"]) + (Dev.IsNull(data["city"]) ? "" : data["city"]) + (Dev.IsNull(data["county"]) ? "" : data["county"]) + (Dev.IsNull(data["town"]) ? "" : data["town"]) + (Dev.IsNull(data["village"]) ? "" : data["village"]));
        }
        //function resize() {
        //    if (!Dev.IsNull(box)) box.SetSize({ Width: 600, Height: 300 });
        //}

        //根据农户id获取农户地块
        function getmassif() {
            var con = "\"CLASSNAME\" ='耕地' ";
            $.ajax({
                url: Dev.GetSystemUrlByRelID("Service") + 'massif/query/byfarmer/' + farmerid,
                type: "post",
                contentType: 'application/json',
                dataType: 'json',
                data: con,
                success: function (result) {
                    if (result.statusCode != 200 || Dev.IsNull(result.data)) {
                        return;
                    }
                    getlinkblocklist(result.data);
                },
                error: function () {
                }
            });
        }
    </script>
</head>
<body>
    <div id="farmercontent" style="height: 400px; width: 600px;">
    </div>
    <div class="basicInfo">
        <div class="info">
            <div class="leftinfo">
                <div class="item">
                    <div class="title">姓名</div>
                    <div name="name" class="value part" tag="isencryp" slen="1" elen="0"></div>
                </div>
                <div class="item">
                    <div class="title">组织机构</div>
                    <div name="orgid" class="value"></div>
                </div>
                <div class="item">
                    <div class="title">联系电话</div>
                    <div class="value part" name="mobilephone" tag="isencryp" slen="3" elen="3"></div>
                </div>
                <div class="item">
                    <div class="title">身份证号</div>
                    <div class="value" name="cardid" tag="isencryp" slen="3" elen="4"></div>
                </div>
                <div class="item">
                    <div class="title">耕地面积</div>
                    <div name="cultivated" class="value part"></div>
                </div>
                <div class="item">
                    <div class="title">银行卡号</div>
                    <div name="bankcard" class="value" tag="isencryp" slen="4" elen="3"></div>
                </div>
                <div class="item">
                    <div class="title">民族</div>
                    <div name="nation" class="value part"></div>
                </div>
                <div class="item">
                    <div class="title">性别</div>
                    <div name="sex" class="value"></div>
                </div>
                <div class="item">
                    <div class="title">文化程度</div>
                    <div name="education" class="value part"></div>
                </div>
                <div class="item">
                    <div class="title">政治面貌</div>
                    <div name="political" class="value"></div>
                </div>
                <div class="item" style="border-bottom: 0px">
                    <div class="title">户口性质</div>
                    <div name="household" class="value part"></div>
                </div>
                <div class="item" style="border-bottom: 0px">
                    <div class="title">户籍地</div>
                    <div name="domicile" class="value"></div>
                </div>
                <div class="item" style="width: 600px;">
                    <div class="title">地区</div>
                    <div name="xzqtext" class="value" style="width: 500px"></div>
                </div>
                <div class="item" style="width: 600px;">
                    <div class="title">详细地址</div>
                    <div name="address" class="value" style="width: 500px"></div>
                </div>
                <div class="item" style="width: 600px; height: 57px">
                    <div class="title">备注</div>
                    <div name="remark" class="value" style="width: 500px; height: 50px; line-height: 15px"></div>
                </div>
            </div>
            <div style="height: 200px; border-left: 1px dashed #ddd; width: 200px; display: inline-block; padding: 7px 5px">
                <div name="imgsview" style="height: 200px; width: 200px; background-repeat: no-repeat; background-position: center; background-image: url('../../image/agri/nopic.png'); background-size: 200px;"></div>
            </div>
        </div>
    </div>
    <div id="massinfo" style="height: 132px; width: 600px"></div>
    <div id="massHead" class="head" style="height: 32px; width: 600px; border-bottom: 1px dashed #ddd;">
        <div style="height: 100%; width: 145px; display: inline-block; float: left; position: relative;">
            <div style="width: 100%; text-align: center; display: inline-block; border-right: 1px dashed #ddd; line-height: 32px; float: left;">
                地块编号
            </div>
        </div>
        <div style="height: 100%; width: 102px; display: inline-block; float: left; position: relative;">
            <div style="width: 100%; text-align: center; display: inline-block; border-right: 1px dashed #ddd; line-height: 32px; float: left;">
                地类名称
            </div>
        </div>
        <div style="height: 100%; width: 101px; display: inline-block; float: left; position: relative;">
            <div style="width: 100%; text-align: center; display: inline-block; border-right: 1px dashed #ddd; line-height: 32px; float: left;">
                权属性质
            </div>
        </div>
        <div style="height: 100%; width: 121px; display: inline-block; float: left; position: relative;">
            <div style="width: 100%; text-align: center; display: inline-block; border-right: 1px dashed #ddd; line-height: 32px; float: left;">
                基本农田类型
            </div>
        </div>
        <div style="height: 100%; width: 121px; display: inline-block; float: left; position: relative;">
            <div style="width: 100%; text-align: center; display: inline-block; border-right: 1px dashed #ddd; line-height: 32px; float: left;">
                基本农田面积(亩)
            </div>
        </div>
    </div>
    <div class="row" style="height: 32px; width: 600px; border-bottom: 1px dashed #ddd;">
        <div name="massifid" style="width: 145px; text-align: center; display: inline-block; border-right: 1px dashed #ddd; line-height: 32px; float: left; height: 32px;"></div>
        <div name="classname" style="width: 101px; text-align: center; display: inline-block; border-right: 1px dashed #ddd; line-height: 32px; float: left; height: 32px;"></div>
        <div name="ownership" style="width: 100px; text-align: center; display: inline-block; border-right: 1px dashed #ddd; line-height: 32px; float: left; height: 32px; overflow-x: hidden; overflow-y: auto"></div>
        <div name="farmlandtype" style="width: 120px; text-align: center; display: inline-block; border-right: 1px dashed #ddd; line-height: 32px; float: left; height: 32px; overflow-x: hidden; overflow-y: auto"></div>
        <div name="farmlandarea" style="width: 120px; text-align: center; display: inline-block; border-right: 1px dashed #ddd; line-height: 32px; float: left; height: 32px;"></div>
    </div>
    <div id="massinfodetail">
        <div style="background-color: #ddd; letter-spacing: 4px; float: left; line-height: 29px; text-align: center; width: 100%;">地块详细信息</div>
        <div>
            <div class="title detail rightAlign">地块编号</div>
            <div id="massifid" class="detail part leftAlign"></div>
        </div>
        <div>
            <div class="title detail rightAlign">地类名称</div>
            <div id="classname" class="detail leftAlign"></div>
        </div>
        <div>
            <div class="title detail rightAlign">权属性质</div>
            <div id="ownership" class="detail part leftAlign" style="overflow-x: hidden; overflow-y: auto"></div>
        </div>
        <div>
            <div class="title detail rightAlign">耕地类型</div>
            <div id="landtype" class="detail leftAlign" style="overflow-x: hidden; overflow-y: auto"></div>
        </div>
        <div>
            <div class="title detail rightAlign">基本农田类型</div>
            <div id="farmlandtype" class="detail part leftAlign" style="overflow-x: hidden; overflow-y: auto"></div>
        </div>
        <div>
            <div class="title detail rightAlign">基本农田面积</div>
            <div id="farmlandarea" class="detail leftAlign"></div>
        </div>
        <div>
            <div class="title detail rightAlign">权属单位名称</div>
            <div id="ownershipname" class="detail leftAlign" style="width: 444px;"></div>
        </div>
        <div>
            <div class="title detail rightAlign">地区</div>
            <div id="region" class="detail leftAlign" style="width: 449px"></div>
        </div>
    </div>
</body>
</html>
