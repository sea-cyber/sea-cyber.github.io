<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>农机注册</title>
    <link rel="stylesheet" href="../../theme/default/easyui.css" />
    <link rel="stylesheet" type="text/css" href="../../theme/icon.css" />
    <link rel="stylesheet" type="text/css" href="../../css/app.css" />
    <link rel="stylesheet" type="text/css" href="../../css/main.css" />
    <link rel="stylesheet" type="text/css" href="../../css/icon.css" />
    <link type="text/css" href="../../css/dev.css" rel="stylesheet" />
    <script type="text/javascript" src="../../js/jquery.min.js"></script>
    <script type="text/javascript" src="../../js/jquery.easyui.min.js"></script>
    <script type="text/javascript" src="../../js/easyui-lang-zh_CN.js"></script>
    <script type="text/javascript" src="../../js/linq.min.js"></script>
    <script type="text/javascript" src="../../js/data.util.js"></script>
    <script type="text/javascript" src="../../js/jquery.dev.control.js"></script>
    <script type="text/javascript" src="../../js/dev.ui.js"></script>
    <script type="text/javascript" src="../../js/guid.js"></script>
    <style type="text/css">
        .content {
            height: 100%;
            width: 100%;
            position: relative;
        }

        .Title {
            width: 75px;
            line-height: 38px;
            height: 38px;
            display: inline-block;
            float: left;
        }

            .Title .Icon {
                width: 16px;
                height: 16px;
                display: inline-block;
                margin-top: 10px;
            }

            .Title .Text {
                display: inline-block;
                float: right;
                padding-right: 5px;
            }

        .title3 {
            width: 63px;
        }

        .content .SearchDiv {
            width: 195px;
            height: 38px;
            display: inline-block;
            margin-left: 0px;
            margin-right: 0px;
        }

        .content .Button {
            width: 60px;
            height: 26px;
            float: left;
            margin-top: 7px;
            background-color: #16dbbb;
            text-align: center;
            border: 1px solid #16dbbb;
            display: inline-block;
            margin-left: 5px;
        }

            .content .Button:hover {
                background-color: #5227de;
                border: 1px solid #5227de;
                cursor: pointer;
            }

            .content .Button:active {
                background-color: #210097;
                border: 1px solid #210097;
                cursor: pointer;
            }

        .content .ButtonDisable {
            background-color: #808080;
            color: #000;
            border: 1px solid #808080;
        }

            .content .ButtonDisable:hover {
                background-color: #808080;
                color: #000;
                border: 1px solid #808080;
            }

        .datagrid-row {
            height: 28px;
        }
    </style>
    <script type="text/javascript">
        var Dev = window.top.window.dev;
        var dataGrid, pageIndex = 1, pageSize = 5;
        var treeControl;
        var searchNum, searchSid, searchBrand, searchType;
        var bindBrand, bindType;         //  绑定数据字典
        var parent;
        var editWin;
        var dialog, flashDialog;
        var orgFilter, modlistFilter;
        var comboTree, modType, orgid1;
        var oldid, updateid;     //oldid修改之前的农机id
        var cDate;        //创建时间
        var isadd = true;            //新增/修改 标识符
        var isposiiton = false, singleclick;
        function WidgetCommunication(s) {   //部件通讯
            parent = s.parent;
            Dev.App.BottomPanel.Header.css({ "background": "#14cdad", "color": "#fcfcfc", "font-weight": "bold" });
            Dev.App.BottomPanel.SetIconCls("machine-carmanage");
            inittree();
            initDataGrid();
            init();
            $(window).resize(function () { resize(); });
            $(".Button").click(function () {
                var tag = $(this).attr("tag");
                if (tag == "add") {
                    isadd = true;          //isadding
                    editClear();
                    initEditWin("农机新增", 'machine-carmanage');
                    $("#errorlog", editWin.Target).html("");        //清空提示区
                    $("#no", editWin.Target).prop("$this").SetReadOnly(false);
                    $("#sid", editWin.Target).prop("$this").SetReadOnly(false);            //新增时激活编辑
                }
                if (tag == "search") { pageIndex = 1; search(); }
                if (tag == "clear") { pageIndex = 1; searchClear(); search(); };
                if (tag == "deletes") deletes();
                if (tag == "save") saveInfo();
                if (tag == "cancel") editWin.Close();
            });
            flashDialog = new Dev.Messager({ Height: 95, Width: 200, AutoShow: false, Type: "question", Timeout: 1500, ButtonVisible: false, AutoVisible: true, Effect: "normal" });
            dialog = new Dev.Messager({ AutoShow: false, Type: "question" });
            //点定位
            singleclick = Dev.App.Map.on("singleclick", function (e) {
                if (!Dev.IsNull(pointkey)) {
                    Dev.MapUtils.removePointKey("devicehighlight", dev.App.Map);
                    pointkey = null;
                }
                if (!isposiiton || Dev.IsNull(editWin)) return;
                isposiiton = false;
                Dev.position = false;
                Dev.MapUtils.ClearFeature("tempGraphicLayer");
                //进行转换
                var mapproj = Dev.App.Map.getView().getProjection();
                if (mapproj.getCode() != Dev.App.Config.SystemMap.DataEPSG) e.coordinate = Dev.proj.transform(e.coordinate, mapproj.getCode(), Dev.App.Config.SystemMap.DataEPSG);
                $(".dev-numberbox[name='longitude']", editWin.Target).prop("$this").SetValue(e.coordinate[0]);
                $(".dev-numberbox[name='latitude']", editWin.Target).prop("$this").SetValue(e.coordinate[1]);
                creatpointf(e.coordinate);
            });
            parent.one("onClosing", function () {
                //页面释放
                Dev.App.BottomPanel.SetHeight(262);
                if (!Dev.IsNull(treeControl)) {
                    treeControl.unbind("onSelectChanged");
                    treeControl = null;
                }
                if (!Dev.IsNull(comboTree)) {
                    comboTree.unbind("onSelectChanged");
                    comboTree = null;
                }
                if (!Dev.IsNull(dataGrid)) {
                    dataGrid.Target.unbind("onSelectPage");
                    dataGrid.Target.unbind("onPageSizeChange");
                    dataGrid.Target.unbind("onClickRow");
                    dataGrid = null;
                }
                if (!Dev.IsNull(editWin)) {
                    editWin.unbind("onClosing");
                    editWin.Close();
                    editWin.Destroy();
                    editWin = null;
                }
                if (!Dev.IsNull(detailWin)) {
                    detailWin.unbind("onClosing");
                    detailWin.Close();
                    detailWin.Destroy();
                    detailWin = null;
                }


                Dev.position = false;
                Dev.MapUtils.ClearFeature("tempGraphicLayer");
                if (!Dev.IsNull(pointkey)) {
                    Dev.MapUtils.removePointKey("devicehighlight", dev.App.Map);
                    pointkey = null;
                }
                if (!Dev.IsNull(singleclick)) Dev.App.Map.unByKey(singleclick);
            });
            resize();
        }
        function init() {
            searchNum = $("#machineNum").prop("$this");         //获取查询输入
            searchSid = $("#machineSid").prop("$this");
            // searchBrand = $("#machineBrand").prop("$this");
            searchType = $("#machineType").prop("$this");
            bindType = Dev.GetDicData(["MacType"]);     //   绑定字典数据
            bindBrand = Dev.GetDicData(["MacBrand"]);
            if (!Dev.IsNull(bindType) && bindType.length > 0) {
                var bt = bindType.concat();         //不改变 字典数据
                bt.unshift({ "data": "不限", "id": 9999999999, "parentid": bt[0].parentid }); //插入数组首部
                searchType.SetData(bt);
                searchType.Layout();
            }
            //if (!Dev.IsNull(bindBrand) && bindBrand.length > 0) {
            //    var bb = bindBrand.concat();
            //    bb.unshift({ "data": "不限", "id": 0000000000, "parentid": bb[0].parentid });
            //    searchBrand.SetData(bb);
            //    searchBrand.Layout();
            //}
        }
        var modlistControl, modlistindex = 1, modlistsize = 5;
        function initModlist() {
            if (Dev.IsNull(editWin)) return;
            modlistControl = $("#modlist", editWin.Target);
            modlistControl.combogrid({
                idField: 'id', textField: 'testfield',
                columns: [[
                        { field: 'type', title: '农机类型', align: 'center', width: 80 },
                        { field: 'spec', title: '农机型号', align: 'center', width: 80 },
                        { field: 'vendor', title: '厂商', align: 'center', width: 80 },
                        { field: 'wheelbase', title: '轴距', align: 'center', width: 80 },
                        { field: 'mintrunradius', title: '最小转弯半径', align: 'center', width: 80 }
                ]],
                width: 154, height: 26, panelWidth: 405, panelHeight: 221, pagination: true, toolbar: $("#toolbarmod"),
            });
            var modlistpage = modlistControl.combogrid("grid").datagrid("getPager");
            var parampage = { showPageList: false, showRefresh: false, pageNumber: modlistindex, pageSize: modlistsize, onSelectPage: function (index, size) { modlistindex = index; getlist(); } };
            modlistpage.pagination(parampage);
            modType = $('#modlistType', modlistControl.combogrid("panel")).prop("$this");
            var bindBrand = Dev.GetDicData(["MacType"]);
            if (!Dev.IsNull(bindBrand) && bindBrand.length > 0) {
                var bb = bindBrand.concat();
                bb.unshift({ "data": "不限", "id": 0000000000, "parentid": bb[0].parentid });
                modType.SetData(bb);
                modType.Layout();
            }
            modNo = $('#macnumSearch', modlistControl.combogrid("panel")).prop("$this");
            $("#macsearch", modlistControl.combogrid("panel")).click(function () {
                toorbarsearch();
            });
            $("#macreset", modlistControl.combogrid("panel")).click(function () {
                toorbarreset();
            });
        }       //初始化下拉可选的农机类型
        function toorbarsearch() {
            modlistindex = 1;
            modlistFilter = "1=1";
            var searchTbGrade = modType.GetText();
            if (!Dev.IsNull(searchTbGrade) && searchTbGrade != "不限") modlistFilter += " AND  \"TYPE\" LIKE '%" + searchTbGrade + "%'";
            if (!Dev.IsNull(orgid1) && orgid1.length > 0) modlistFilter += " AND " + orgid1;
            var searchTbno = $.trim(modNo.GetValue());
            if (!Dev.IsNull(searchTbno)) modlistFilter += " AND ( \"SPEC\"  LIKE '%" + searchTbno + "%'" + " OR " + "UPPER( \"SPEC\" )  LIKE " + "UPPER('%" + searchTbno + "%')" + " OR " + "LOWER( \"SPEC\" )  LIKE " + "LOWER('%" + searchTbno + "%'))";       //大小写不敏感
            getlist();         //新增时 
        }
        function toorbarreset() {
            if (!Dev.IsNull(modType)) modType.SetValue("");
            if (!Dev.IsNull(modNo)) modNo.Clear();
            toorbarsearch();
        }
        //获取机型数据
        function getlist() {
            var con = "1=1";
            if (!Dev.IsNull(modlistFilter)) con += "AND " + modlistFilter;
            con += " ORDER BY \"CREATEDATE\" DESC";
            $.ajax({
                url: Dev.GetSystemUrlByRelID("Service") + "deviceModel/getbyfilter/" + modlistindex + "/" + modlistsize,
                type: "POST",
                contentType: 'application/json',
                dataType: 'json',
                async: false,
                data: con,
                success: function (result) {
                    if (!Dev.IsNull(modlistControl)) { //绑定数据
                        for (var i = 0; i < result.data.dataSource.length; i++) result.data.dataSource[i].testfield = result.data.dataSource[i].vendor + "-" + result.data.dataSource[i].spec + "-" + result.data.dataSource[i].type;
                        modlistControl.combogrid("grid").datagrid("loadData", result.data.dataSource);
                        var page = modlistControl.combogrid("grid").datagrid("getPager");
                        page.pagination('refresh', { total: result.data.pageInfo.totalCount, pageNumber: result.data.pageInfo.pageIndex });
                    }
                }
            });
        }

        function initEditWin(title, cls) {
            modlistindex = 1;
            if (Dev.IsNull(editWin)) {                    //添加窗体
                editWin = new Dev.Window({
                    ID: "editMachineWin",
                    IconCls: cls,
                    Title: title,
                    Parent: Dev.App.FillPanel.Target,
                    Maximizable: false,
                    Modal: false,
                    Draggable: true,
                    HAlign: 'center',
                    VAlign: 'center',
                    Resizable: false,
                    Content: $("#EditDiv"),
                    Height: 336,
                    Width: 500
                });
                comboTree = new Dev.Combotree({
                    Required: true, PopupHeight: 'auto', TipInfo: "请选择",
                    MultiSelect: false, StateField: "State", ValueField: "id",
                    TextField: "name", ChildrenField: "child", Height: 24, Border: "1px", Width: 154
                });
                $("#treecomboDiv", $(".MachineEdit", Dev.App.FillPanel.Target)).append(comboTree.Target);
                comboTree.Layout();
                initModlist();
                comboTree.bind("onSelectChanged", function (s, e) {
                    var cur_list = [];
                    cur_list.push(e.$this.id);
                    var isleaf = comboTree.tree.IsLeaf(e);
                    if (!isleaf) {
                        var allchilds = treeControl.GetAllChildren(e);
                        for (var i = 0; i < allchilds.length; i++) cur_list.push(allchilds[i].id);
                    }
                    orgid1 = "";
                    if (Dev.IsNull(cur_list) || cur_list.length == 0) return;
                    orgid1 = "\"ORGID\"  IN(";
                    for (var i = 0; i < cur_list.length; i++) orgid1 += "'" + cur_list[i] + "',";
                    orgid1 = orgid1.substr(0, orgid1.length - 1);
                    orgid1 += ")";
                    toorbarsearch();
                });
                var selectnode = treeControl.GetSelectNode();
                comboTree.SetData(selectnode[0].$this);

                $(".PositionBtn", editWin.Target).click(function () {
                    isposiiton = true;
                    Dev.position = true;
                    Dev.App.MapPanel.MapDOM.css("cursor", "url(image/location.cur),auto");
                });
                editWin.bind("onClosing", function () {
                    isposiiton = false;
                    Dev.position = false;
                    showmodal(false);
                    editClear();
                    Dev.MapUtils.ClearFeature("tempGraphicLayer");
                    search(isadd ? "add" : "update");

                });
            }
            else {      //窗体不为空时 的新增，例如 修改操作马上再进行 新增
                editWin.Open();
                editWin.SetTitle(title);
                editWin.SetIconCls(cls);
                editClear();
                var selectnode = treeControl.GetSelectNode();
                comboTree.SetData(selectnode[0].$this);
            }
            getlist();
            showmodal(true);
        }       //输入标题 与 图标
        function inittree() {
            treeControl = $('.dev-tree').prop("$this");
            treeControl.bind("onSelectChanged", function (s, e) {
                pageIndex = 1;          //切换组织结构时，从第一面开始显示
                searchClear();
                var treenode = e;
                var isleaf = treeControl.IsLeaf(treenode);
                var orgids = [];
                orgids.push(e.id);
                if (!isleaf) {
                    var allchilds = treeControl.GetAllChildren(treenode);
                    for (var i = 0; i < allchilds.length; i++) orgids.push(allchilds[i].id);
                }
                orgFilter = "";
                if (Dev.IsNull(orgids) || orgids.length == 0) return;
                orgFilter = "\"ORGID\"  IN(";
                for (var i = 0; i < orgids.length; i++) orgFilter += "'" + orgids[i] + "',";
                orgFilter = orgFilter.substr(0, orgFilter.length - 1);
                orgFilter += ")";
                search();
            });
            var orgid = Dev.cookie.user.orgid;
            $.ajax({
                url: Dev.GetSystemUrlByRelID("Service") + "organize/gettreebyid/" + orgid + "?" + new Date().getTime(),
                type: "Get",
                contentType: 'application/json',
                dataType: 'json',
                success: function (result) {
                    treedata = Dev.ConvertTreeData(result.data, orgid);
                    treeControl.LoadData(treedata);
                    if (treedata.length > 0) treeControl.SetSelectNode(treeControl.GetRoots()[0]);

                }
            });
        }
        function initDataGrid() {
            if (Dev.IsNull(dataGrid)) {
                $("#gridDiv").empty();
                var columns = [
                    { field: "ck", width: 30, align: 'center', title: '勾选', sortable: false, checkbox: true },
                    {
                        field: "online", width: 15, align: 'center', title: '', sortable: false, formatter: function (value, row, index) {
                            var str = '<img src="../../image/agri/carmanage2.png"></img>';
                            if (!Dev.IsNull(row.onlinestate) && row.onlinestate == "1") str = '<img src="../../image/agri/carmanage1.png"></img>';
                            return str;
                        }
                    },
                    { field: "no", width: 80, align: 'center', title: '设备编号', sortable: false },
                    { field: "serialnumber", width: 100, align: 'center', title: '设备序列号', sortable: false },
                    { field: "vendor", width: 80, align: 'center', title: '厂商', sortable: false },
                    { field: "spec", width: 80, align: 'center', title: '型号', sortable: false },
                    { field: "type", width: 80, align: 'center', title: '类型', sortable: false },
                    { field: "use", width: 100, align: 'center', title: '用途', sortable: false },
                      {
                          field: "_oprate", width: 50, align: 'center', title: '操作', sortable: false, formatter: function (value, row, index) {
                              return '<a href="javascript:void(0)" style="color:blue;"onclick="update(\'' + row.id + '\',\'' + index + '\')"><img src="../../image/agri/update.png"/></a>'
                                  + '&nbsp;<a href="javascript:void(0)" style="color:blue;margin-left:6px;" onclick="detailInfo(\'' + row.id + '\')" title="详细信息"><img src="../../image/agri/cartype.png"/></a>&nbsp;<a href="javascript:void(0)" style="color:blue;margin-left:6px;" onclick="deleteinfo(\'' + index + '\')"><img src="../../image/agri/delete.png"/></a>';
                          }
                      },
                ];
                dataGrid = new UCDataGrid(Dev, { PageIndex: pageIndex, PageSize: pageSize, RowNumbers: false, ID: "machineGrid", pagequery: false, IsSizeSelect: true });
                $("#gridDiv").append(dataGrid.Target);
                dataGrid.Layout(columns);
                dataGrid.Target.bind("onSelectPage", function (s, e) {
                    pageIndex = e.index;
                    search();
                });
                dataGrid.Target.bind("onClickRow", function (s, e) {
                    var row = e.Row;
                    highlight(row);
                });
                dataGrid.Target.bind("onPageSizeChange", function (s, e) {
                    if (Dev.IsNull(e)) return;
                    pageIndex = 1;
                    pageSize = e;
                    search();
                });
            }
        }

        var detailWin;
        function detailInfo(id) {
            if (Dev.IsNull(detailWin)) {
                detailWin = new Dev.Window({
                    ID: "detailwin",
                    IconCls: 'icon-detailinfo',
                    Title: "农机详情",
                    Parent: Dev.App.FillPanel.Target,
                    Maximizable: false,
                    Modal: true,
                    Draggable: true,
                    HAlign: 'center',
                    VAlign: 'center',
                    Resizable: false,
                    Url: Dev.App.Root + "html/detailinfo/agrimachine.html",
                    Height: 390,
                    Width: 500,
                    Parameters: { id: id }
                });
                detailWin.bind("onClosing", function () {
                });
            } else {
                detailWin.SetUrl(Dev.App.Root + "html/detailinfo/agrimachine.html");
                detailWin.Parameters = { id: id };
                detailWin.Open();
            }
        } //初始化详细信息页面

        function getCondition() {
            var condition = " 1=1 ";
            condition += "AND \"DEVICETYPE\" = '" + Dev.DeviceType.machine + "'";
            if (!Dev.IsNull(searchNum)) {
                var mNo = searchNum.GetValue();
                if (!Dev.IsNull(mNo) && mNo.length > 0) condition += " AND ( \"NO\"  LIKE '%" + $.trim(mNo) + "%'" + " OR " + "UPPER( \"NO\" )  LIKE " + "UPPER('%" + $.trim(mNo) + "%')" + " OR " + "LOWER( \"NO\" )  LIKE " + "LOWER('%" + $.trim(mNo) + "%'))";       //大小写不敏感
            }
            if (!Dev.IsNull(searchSid)) {
                var mSid = searchSid.GetValue();
                if (!Dev.IsNull(mSid) && mSid.length > 0) condition += " AND ( \"SERIALNUMBER\"  LIKE '%" + $.trim(mSid) + "%'" + " OR " + "UPPER( \"SERIALNUMBER\" )  LIKE " + "UPPER('%" + $.trim(mSid) + "%')" + " OR " + "LOWER( \"SERIALNUMBER\" )  LIKE " + "LOWER('%" + $.trim(mSid) + "%'))";
            }
            //if (!Dev.IsNull(searchBrand)) {         //combobox
            //    var mBrand = searchBrand.GetText();
            //    if (!dev.IsNull(mBrand) && mBrand.length > 0 && mBrand != "不限") condition += " AND  \"BRAND\" LIKE '%" + $.trim(mBrand) + "%'";
            //}
            if (!Dev.IsNull(searchType)) {
                var mType = searchType.GetText();       //获取combobox的值
                if (!dev.IsNull(mType) && mType.length > 0 && mType != "不限") condition += " AND  \"TYPE\" LIKE '%" + $.trim(mType) + "%'";
            }
            //组织机构
            if (!dev.IsNull(orgFilter)) condition += " AND  " + orgFilter;
            // condition += "ORDER BY  \"UPDATEDATE\"" + "DESC";
            return condition;
        }        //获取农机查询条件
        function search() {
            var con = getCondition();
            $.ajax({
                type: "POST",
                data: con,
                contentType: "application/json",
                url: Dev.GetSystemUrlByRelID("Service") + "device/" + "real/page/" + pageIndex + "/" + pageSize,
                success: function (result) {
                    if (!result.statusCode == 200) return;
                    dataGrid.Load(result.data.dataSource, result.data.pageInfo);
                    showpagedata(result.data.dataSource);
                }
            });
        }
        function searchClear() {
            var textcontrol = $(".dev-textbox");
            for (var i = 0; i < textcontrol.length; i++) $(textcontrol[i]).prop("$this").Clear();
            if (!Dev.IsNull(searchType)) searchType.SetValue("");
            //  if (!Dev.IsNull(searchBrand)) searchBrand.SetValue("");
        }        //清除所有查询条件，重置

        function verify(model) {
            var errorMsg = $("#errorlog", $(".MachineEdit", Dev.App.FillPanel.Target));
            errorMsg.html("");
            if (Dev.IsNull(model.no)) { errorMsg.html("设备编号不能为空！"); return false; }
            if (Dev.IsNull(model.serialnumber)) { errorMsg.html("序列号不能为空！"); return false; }
            if (!Dev.IsNull(model.serialnumber.replace(/[^\u4e00-\u9fa5]/gi, ""))) { errorMsg.html("序列号不能为中文！"); return false; }
            if (Dev.IsNull(model.type)) { errorMsg.html("机型不能为空！"); return false; }
            if (Dev.IsNull(model.latitude) || Dev.IsNull(model.longitude)) { errorMsg.html("坐标信息不能为空！"); return false }
            if (model.no.length > 18) { errorMsg.html("设备编号太长！"); return false; }
            if (model.use.length > 50) { errorMsg.html("用途描述太长！"); return false; }
            if (model.serialnumber.length > 36) { errorMsg.html("序列号太长！"); return false; }
            if (model.remark.length > 120) { errorMsg.html("备注太长！"); return false; }
            return true;
        }
        function saveInfo() {
            var textcontrol = $(".dev-textbox", $(".MachineEdit", Dev.App.FillPanel.Target));
            var numbercontrol = $('.dev-numberbox', $(".MachineEdit", Dev.App.FillPanel.Target));
            var comboboxcontrol = $(".dev-combobox", $(".MachineEdit", Dev.App.FillPanel.Target));
            var model = {};
            var row = modlistControl.combogrid("grid").datagrid("getSelected");
            //model.modelid = $("#modlist", editWin.Target).combogrid("getText");
            if (!Dev.IsNull(row)) {
                $.each(row, function (e, o) {
                    if (e != "id") model[e] = o;
                });
            }
            else if (!isadd) {
                var oldupdatemodel = editWin.Target.prop("updatemodel");
                model.vendor = oldupdatemodel.vendor;
                model.spec = oldupdatemodel.spec;
                model.type = oldupdatemodel.type;
                editWin.Target.removeProp("updatemodel");
            }
            $("#errorlog", $(".MachineEdit", Dev.App.FillPanel.Target)).html("");
            for (var i = 0; i < textcontrol.length; i++) {
                var tag = $(textcontrol[i]).attr("name");
                var value = $(textcontrol[i]).prop("$this").GetValue().trim();
                model[tag] = value;
            }

            for (var i = 0; i < numbercontrol.length; i++) {
                var tag = $(numbercontrol[i]).attr("name");
                var value = $(numbercontrol[i]).prop("$this").GetValue().trim();
                model[tag] = value;
            }
            for (var i = 0; i < comboboxcontrol.length; i++) {
                var tag = $(comboboxcontrol[i]).attr("name");
                var value = $(comboboxcontrol[i]).prop("$this").GetText();          //获取combobox选定值
                model[tag] = value;
            }
            model.orgid = comboTree.GetValue();     //根据Select选项获取orgid
            var pathMethod;
            var mydate = new Date();
            var isUnique = true;    //是否唯一标志
            if (isadd) {
                model.devicetype = Dev.DeviceType.machine;
                if (!Dev.IsNull(model["serialnumber"])) {        //唯一性检查
                    $.ajax({
                        type: "GET",
                        async: false,
                        contentType: "application/json",
                        url: Dev.GetSystemUrlByRelID("Service") + "device/getbyfilter/\"SERIALNUMBER\"=\'" + model["serialnumber"] + "\'",  //  "no"='1'
                        success: function (result) {        //查询成功存在后台返回空数据
                            if (result.statusCode == 200 && result.data.length !== 0) {
                                isUnique = false;
                            }
                        }
                    });
                }
                if (!isUnique) { $("#errorlog", $(".MachineEdit", Dev.App.FillPanel.Target)).html("序列号已存在！"); return; }
                isUnique = true;
                if (!Dev.IsNull(model["no"])) {
                    $.ajax({
                        type: "GET",
                        async: false,
                        contentType: "application/json",
                        url: Dev.GetSystemUrlByRelID("Service") + "device/getbyfilter/\"NO\"=\'" + model["no"] + "\'",  //  "no"='1'
                        success: function (result) {
                            if (result.statusCode == 200 && result.data.length !== 0) {
                                isUnique = false;
                            }
                        }
                    });
                }
                if (!isUnique) { $("#errorlog", $(".MachineEdit", Dev.App.FillPanel.Target)).html("设备编号已存在！"); return; }

                model.id = Guid.NewGuid().ToString("N");
                pathMethod = "insert";
            }
            else {
                model.id = oldid;  //如果是修改，需要获取旧的id（主键信息）
                pathMethod = "updateDevice";
            }   //区别新增还是更新
            var isok = verify(model);            //简单长度与非空验证
            if (!isok) return;
            if (pathMethod == "insert") model["createdate"] = mydate;//初始赋值为一个很早的时间，便于排序
            else model["updatedate"] = mydate;
            //根据经纬度获取省市县乡
            var positionf = new Dev.Feature(new Dev.geom.Point([parseFloat(model.longitude), parseFloat(model.latitude)]));
            var placedata = Dev.getplacedata(positionf);
            if (!Dev.IsNull(placedata)) {
                if (!Dev.IsNull(placedata.country)) model.country = placedata.country;
                if (!Dev.IsNull(placedata.province)) model.province = placedata.province;
                if (!Dev.IsNull(placedata.city)) model.city = placedata.city;
                if (!Dev.IsNull(placedata.county)) model.county = placedata.county;
                if (!Dev.IsNull(placedata.town)) model.town = placedata.town;
            }

            $.ajax({
                type: "POST",
                data: JSON.stringify(model),
                contentType: "application/json",
                url: Dev.GetSystemUrlByRelID("Service") + "device/" + pathMethod,
                success: function (result) {
                    if (!result.statusCode == 200 || model.length == 0) return;
                    editWin.Close();
                    //search(pathMethod == "update");
                    flashDialog.Alert((pathMethod == "insert" ? "新增成功!" : "修改成功!"), "info");
                },
                error: function (msg) {
                    if (pathMethod == "insert") flashDialog.Alert("新增失败!", "info")
                    else flashDialog.Alert("修改失败!", "info");
                }
            });

        }
        function update(id, index) {
            isadd = false;         //isModify
            updateid = id;
            dataGrid.DataGrid.datagrid("selectRow", index);
            var row = dataGrid.DataGrid.datagrid("getSelected");
            cDate = row.createdate;         //存储修改前 农机的时间信息
            oldid = row.id;
            if (Dev.IsNull(row) || row.length == 0) return;
            initEditWin("农机修改", "machine-trackedit");
            if (!Dev.IsNull(row.orgid)) comboTree.SetValueEx(row.orgid);
            $("#no", editWin.Target).prop("$this").SetReadOnly(true);
            $("#no", editWin.Target).prop("$this").SetDisabled(true);
            $("#sid", editWin.Target).prop("$this").SetReadOnly(true);    //修改时 禁止编辑功能
            $("#sid", editWin.Target).prop("$this").SetDisabled(true);      //背景加上灰色
            $("#errorlog", editWin.Target).html("");
            loadData(row);
        }   // 修改/更新农机信息
        function deletes() {
            var rows = dataGrid.DataGrid.datagrid("getChecked");
            var curRowNo = dataGrid.DataGrid.datagrid("getData").total;       //获取已有的数据行数
            if (curRowNo == rows.length && pageIndex != 1) pageIndex -= 1;     //如果没删完，保持在本页，删完回到上一页。
            if (Dev.IsNull(rows) || rows.length == 0) {
                flashDialog.Alert("请选择需要删除的数据!", "info");
                return;
            }
            var nos = [];
            for (var i = 0, len = rows.length; i < len; i++) {
                nos.push(rows[i].no);
            }
            dialog.Confirm('确定删除所有勾选记录吗？', function (r) {
                if (!r) return;
                $.ajax({
                    type: "DELETE",
                    url: Dev.GetSystemUrlByRelID("Service") + "device/delete?no=" + encodeURIComponent(nos.join(",")),
                    success: function (re) {
                        if (!re.statusCode == 200) { flashDialog.Alert("删除失败!", "info"); return; };
                        flashDialog.Alert("删除成功!", "info")
                        search();
                    },
                    error: function (msg) {
                        flashDialog.Alert("删除失败!", "info");
                    }
                });
            }, "question");
        }        //批量删除
        function deleteinfo(index) {
            dataGrid.DataGrid.datagrid("selectRow", index);
            var row = dataGrid.DataGrid.datagrid("getSelected");
            var curRowNo = dataGrid.DataGrid.datagrid("getData").total;       //获取已有的数据行数
            if (curRowNo == 1 && pageIndex != 1) pageIndex -= 1;                //删光则返回上一页
            if (Dev.IsNull(row)) return;
            dialog.Confirm('确定删除选中记录吗？', function (r) {
                if (!r) return;
                $.ajax({
                    type: "DELETE",
                    url: Dev.GetSystemUrlByRelID("Service") + "device/delete?no=" + encodeURIComponent(row.no),//encodeURIComponent
                    success: function (result) {
                        if (!result.statusCode == 200) { flashDialog.Alert("删除失败!", "info"); return; };
                        flashDialog.Alert("删除成功!", "info")
                        search();
                    },
                    error: function (msg) {
                        flashDialog.Alert("删除失败!", "info")
                    }
                });
            }, "question");
        }  //删除

        function resize() {
            var wh = Dev.App.BottomPanel.Target.outerHeight();
            var height = $(window).outerHeight();
            var gridheight = height - 40;
            var gridwidth = parseInt($(window).width() * 0.80) - 2;
            treeControl.SetHeight(height == 0 ? (wh - 26) : (height - 26));
            if (gridwidth < 1200) {
                gridwidth = 1200;
                gridheight = parseInt(gridheight) - 16;
            }
            $("#searchDiv").width(gridwidth);
            $("#gridDiv").height(gridheight).width(gridwidth);
            if (!Dev.IsNull(dataGrid)) dataGrid.Resize(gridwidth, gridheight);
        }

        function editClear() {
            var textcontrol = $(".dev-textbox", $(".MachineEdit", Dev.App.FillPanel.Target));
            var numbercontrol = $(".dev-numberbox", $(".MachineEdit", Dev.App.FillPanel.Target));
            var comboboxcontrol = $(".dev-combobox", $(".MachineEdit", Dev.App.FillPanel.Target));
            for (var i = 0; i < textcontrol.length; i++) {
                var currcontrol = $(textcontrol[i]).prop("$this");
                currcontrol.Clear();
                if (!Dev.IsNull(currcontrol.SetLengthTip)) currcontrol.SetLengthTip("");
            }
            for (var i = 0; i < numbercontrol.length; i++) { var currcontrol = $(numbercontrol[i]).prop("$this"); currcontrol.Clear(); }
            for (var i = 0; i < comboboxcontrol.length; i++) { var currcontrol = $(comboboxcontrol[i]).prop("$this"); currcontrol.SetValue(""); }
            $("#modlist", $(".MachineEdit", Dev.App.FillPanel.Target)).combogrid("setValue", "");
            $("#modlist", $(".MachineEdit", Dev.App.FillPanel.Target)).combogrid("hidePanel");
        }      //清空所有信息
        function loadData(model) {
            var textcontrol = $(".dev-textbox", $(".MachineEdit", Dev.App.FillPanel.Target));
            var numbercontrol = $('.dev-numberbox', $(".MachineEdit", Dev.App.FillPanel.Target));
            var comboboxcontrol = $(".dev-combobox", $(".MachineEdit", Dev.App.FillPanel.Target));
            var selectnode = treeControl.GetSelectNode();
            comboTree.SetData(selectnode[0].$this);
            if (!Dev.IsNull(model.orgid)) comboTree.SetValueEx(model.orgid);

            for (var i = 0; i < textcontrol.length; i++) {
                var tag = $(textcontrol[i]).attr("name");
                var currcontrol = $(textcontrol[i]).prop("$this");
                if (!Dev.IsNull(currcontrol)) {
                    currcontrol.SetValue(model[tag]);
                    currcontrol.SetLengthTip(model[tag]);
                }
            }
            for (var i = 0; i < numbercontrol.length; i++) {
                var tag = $(numbercontrol[i]).attr("name");
                var currcontrol = $(numbercontrol[i]).prop("$this");
                if (!Dev.IsNull(currcontrol) && !Dev.IsNull(model[tag])) currcontrol.SetValue(model[tag]);
            }
            for (var i = 0; i < comboboxcontrol.length; i++) {
                var tag = $(comboboxcontrol[i]).attr("name");
                var currcontrol = $(comboboxcontrol[i]).prop("$this");
                if (!Dev.IsNull(currcontrol)) currcontrol.SetText(model[tag]);        //combobox  
            }
            //添加经纬度位置
            if (!Dev.IsNull(model.longitude) && !Dev.IsNull(model.latitude)) creatpointf([parseFloat(model.longitude), parseFloat(model.latitude)]);
            var combogridvalue = "";
            if (!Dev.IsNull(model.vendor)) combogridvalue += model.vendor + "-";
            if (!Dev.IsNull(model.spec)) combogridvalue += model.spec + "-";
            if (!Dev.IsNull(model.type)) combogridvalue += model.type;
            modlistControl.combogrid("setValue", combogridvalue);
            // modlistControl.prop("curr", model);
            editWin.Target.prop("updatemodel", model);
        }       //加载被修改的农机信息
        function creatpointf(point) {
            if (Dev.IsNull(point)) return;
            var positionf = new Dev.Feature(new Dev.geom.Point(point));
            var style = new Dev.style.Style({ image: new Dev.style.Icon({ anchor: [0.5, 1], src: Dev.App.Root + "image/maptool/location.png" }) })
            positionf.setStyle(style);
            Dev.MapUtils.AddFeature(positionf, "tempGraphicLayer", Dev.App.Map);
        }      //构建定位元素
        function showmodal(isshow) {
            if (Dev.IsNull(isshow)) return;
            $("#shade").css("display", (isshow ? "block" : "none"));
        }
        function showpagedata(data) {
            if (!Dev.IsNull(pointkey)) {
                Dev.MapUtils.removePointKey("devicehighlight", dev.App.Map);
                pointkey = null;
            }
            Dev.MapUtils.ClearFeature("tempGraphicLayer");
            if (Dev.IsNull(data) || data.length == 0) return;
            var features = [];
            for (var i = 0; i < data.length; i++) {
                var x = data[i].longitude;
                var y = data[i].latitude;
                if (!Dev.IsNullAll(data[i].rlongtitude) && parseFloat(data[i].rlongtitude) > 0) x = data[i].rlongtitude;
                if (!Dev.IsNullAll(data[i].rlatitude) && parseFloat(data[i].rlatitude) > 0) y = data[i].rlatitude;
                //var temp_point = [parseFloat(x), parseFloat(y)];
                //var mapproj = Dev.App.Map.getView().getProjection();
                //if (mapproj.getCode() != Dev.App.Config.SystemMap.DataEPSG) temp_point = Dev.proj.tranform(temp_point, Dev.App.Config.SystemMap.DataEPSG, mapproj.getCode());
                var c_p = new Dev.Feature(new Dev.geom.Point([parseFloat(x), parseFloat(y)]));
                //添加样式
                var iconsrc = Dev.App.Root + "image/agri/deviceunline.png";
                if (data[i].onlinestate == "1") iconsrc = Dev.App.Root + "image/agri/deviceonline.png";
                c_p.setStyle(new Dev.style.Style({
                    fill: new Dev.style.Fill({ color: [236, 179, 73, 0.2] }),
                    image: new Dev.style.Icon({
                        src: iconsrc
                    })
                }));
                features.push(c_p);
            }
            var extend = Dev.getExtentByFeatures(features);
            if (!Dev.IsNull(extend)) {
                //设置位置文本
                var points = [[extend[0], extend[1]], [extend[0], extend[3]], [extend[2], extend[3]], [extend[2], extend[1]], [extend[0], extend[1]]];
                var extendfeature = new Dev.Feature(new Dev.geom.Polygon([points]));
                Dev.setcountyposition(extendfeature);
                var mapproj = Dev.App.Map.getView().getProjection();
                if (mapproj.getCode() != Dev.App.Config.SystemMap.DataEPSG) extend = Dev.proj.transformExtent(extend, Dev.App.Config.SystemMap.DataEPSG, mapproj.getCode());
                Dev.App.Map.getView().fit(extend, Dev.App.Map.getSize());
            }
            Dev.MapUtils.ClearAndAddFeatures(features, "tempGraphicLayer");
        }
        var pointkey;
        function highlight(row) {
            if (!Dev.IsNull(pointkey)) {
                Dev.MapUtils.removePointKey("devicehighlight", dev.App.Map);
                pointkey = null;
            }
            var x = row.longitude;
            var y = row.latitude;
            if (!Dev.IsNullAll(row.rlongtitude) && parseFloat(row.rlongtitude) > 0) x = row.rlongtitude;
            if (!Dev.IsNullAll(row.rlatitude) && parseFloat(row.rlatitude) > 0) y = row.rlatitude;
            var feature = new Dev.Feature({
                id: "devicehighlight",
                geometry: new Dev.geom.Point([parseFloat(x), parseFloat(y)])
            });

            feature.setId("devicehighlight");
            pointkey = Dev.MapUtils.PointSymbolStyle1(feature, 1, "rgba(63, 85, 225, 1)", "rgba(63,85,225,0.5)", null, Dev.App.Map);
            var curr_center = [parseFloat(x), parseFloat(y)];
            var mapproj = Dev.App.Map.getView().getProjection();
            if (mapproj.getCode() != Dev.App.Config.SystemMap.DataEPSG) curr_center = Dev.proj.transform(curr_center, Dev.App.Config.SystemMap.DataEPSG, mapproj.getCode());
            Dev.App.Map.getView().centerOn(curr_center, Dev.App.Map.getSize(), [Dev.App.Map.getSize()[0] / 2, Dev.App.Map.getSize()[1] / 2]);
        }
    </script>
</head>
<body>
    <div id="shade" style="width: 100%; height: 100%; position: absolute; z-index: 10; display: none; background: rgba(255,255,255,0.3)"></div>
    <div id="content" class="content">
        <div style="height: 100%; width: 20%; position: absolute;">
            <div id="treediv" style="width: 100%; height: 100%;">
                <div class="dev-tree" opt='{"ValueField":"id","TextField":"name","ChildrenField":"child","Height":210}'></div>
            </div>
        </div>
        <div style="height: 100%; width: 80%; position: absolute; left: 20%; overflow: auto; overflow-y: hidden">
            <div id="searchDiv" style="height: 38px; width: 100%; border-left: 1px solid #ddd; position: relative; min-width: 1200px;">
                <div style="height: 38px; position: absolute; left: 0px;">
                    <div class="SearchDiv">
                        <div id="machineNum" class="dev-textbox" style="z-index: 2; width: 190px; display: inline-block;" opt='{"TipInfo":"","HeaderCSS":{"padding":"0px","width":"75px"},"IsOverShow":true,"Padding":"0px 5px","TextAlign":"left","BodyCSS": { "background-color": "transparent","margin-top":"8px","margin-right":"8px"},"Title":"<div class=\"Title\"><div class=\"Icon machine-carnum\"></div><span class=\"Text\">设备编号</span></div>"}'></div>
                    </div>
                    <div class="SearchDiv" style="width: 182px">
                        <div id="machineSid" class="dev-textbox" style="z-index: 2; width: 190px; display: inline-block;" opt='{"TipInfo":"","HeaderCSS":{"padding":"0px","width":"75px"},"IsOverShow":true,"Padding":"0px 5px","TextAlign":"left","BodyCSS": { "background-color": "transparent","margin-top":"8px","margin-right":"8px","margin-left":"-12px"},"Title":"<div class=\"Title title3\"><div class=\"Icon machine-carnum\"></div><span class=\"Text\">序列号</span></div>"}'></div>
                    </div>
                    <!--  <div class="SearchDiv">
                        <div id="machineBrand" class="dev-combobox" style="z-index: 2; width: 190px; display: inline-block; margin-top: 8px;" opt='{ "PopupHeight":"auto","TextField":"data","ValueField":"id","TipInfo":"选择车辆品牌","HeaderCSS":{"padding":"0px","width":"75px","margin-top":"-8px"},"IsOverShow":true,"Padding":"0px 5px","TextAlign":"left","BodyCSS": {"background-color": "transparent","margin-right":"8px"},"Title":"<div class=\"Title\"><div class=\"Icon machine-carpp\" ></div><span class=\"Text\">车辆品牌</span></div>"}'></div>
                    </div>-->
                    <div class="SearchDiv Last">
                        <div id="machineType" class="dev-combobox" style="z-index: 2; width: 190px; display: inline-block; margin-top: 8px;" opt='{"PopupHeight":"auto","TextField":"data","ValueField":"id","TipInfo":"请选择","HeaderCSS":{"padding":"0px 5px","width":"75px","margin-top":"-8px"},"IsOverShow":true,"Padding":"0px 5px","TextAlign":"left","BodyCSS": { "background-color": "transparent"},"Title":"<div class=\"Title\" ><div class=\"Icon machine-cartype\"></div><span class=\"Text\">车辆类型</span></div>"}'></div>
                    </div>
                </div>
                <div style="width: 299px; height: 100%; position: absolute; right: 10px; z-index: 2; top: -2px;">
                    <div class="Button" tag="search" style="margin-left: 10px;">
                        <div class="machine-query" style="height: 16px; width: 16px; margin-top: 4px; margin-left: 5px; display: inline-block; float: left;"></div>
                        <span style="line-height: 28px; color: #fcfcfc;">查&nbsp;询</span>
                    </div>
                    <div class="Button" tag="clear">
                        <div class="machine-reset" style="height: 16px; width: 16px; margin-top: 4px; margin-left: 5px; display: inline-block; float: left;"></div>
                        <span style="line-height: 28px; color: #fcfcfc;">重&nbsp;置</span>
                    </div>
                    <div class="Button" tag="add">
                        <div class="machine-add" style="height: 16px; width: 16px; margin-top: 4px; margin-left: 5px; display: inline-block; float: left;"></div>
                        <span style="line-height: 28px; color: #fcfcfc;">新&nbsp;增</span>
                    </div>
                    <div class="Button" tag="deletes" style="width: 75px;">
                        <div class="machine-deletes" style="height: 16px; width: 16px; margin-top: 4px; margin-left: 5px; display: inline-block; float: left;"></div>
                        <span style="line-height: 28px; color: #fcfcfc;">批量删除</span>
                    </div>
                </div>
            </div>
            <div id="gridDiv" style="width: 100%; border-left: 1px solid #ddd; border-top: 1px solid #ddd;"></div>
        </div>
    </div>
    <div id="EditDiv" class="MachineEdit" style="height: 300px;">
        <div class="Row">
            <div class="Cell">
                <div id="no" class="dev-textbox" name="no" style="width: 239px; height: 24px; margin-top: 6px;" opt='{"MaxLength":18, "Required":true, "TipInfo":"18位以内","HeaderCSS":{"padding":"0px","width":"85px"},"IsOverShow":true,"Padding":"0px 5px","Title":"<div class=\"Title\"><span>设备编号</span></div>"}'></div>
            </div>
            <div class="Cell">
                <div style="width: 80px; height: 100%; line-height: 35px; text-align: right; padding-right: 5px; float: left">选择组织</div>
                <div id="treecomboDiv" style="height: 24px; width: 154px; margin-top: 5px; display: block; float: left;">
                </div>
            </div>
        </div>
        <div class="Row">
            <div class="Cell">
                <div id="sid" class="dev-textbox" name="serialnumber" style="width: 239px; height: 24px; margin-top: 6px;" opt='{"MaxLength":36, "Required":true, "TipInfo":"36位以内","Precision":0,  "HeaderCSS":{"padding":"0px","width":"85px"},"Padding":"0px 5px","Title":"<div class=\"Title\"><span>序列号</div>"}'></div>
            </div>
            <div class="Cell">
                <div style="display: inline-block; width: 80px; line-height: 35px; float: left; text-align: right; padding-right: 5px;" opt='{"Required":true,"Readonly":true}'><span>农机机型</span></div>
                <div style="width: 152px; height: 35px; line-height: 33px; display: inline-block; float: left; margin-top: 1px; position: relative;">
                    <div id="modlist" data-options="editable:false"></div>
                    <div style="position: absolute; height: 10px; width: 10px; top: 12px; right: 20px; color: red; line-height: 10px;">*</div>
                </div>
            </div>
        </div>
        <div class="Row">
            <div class="Cell">
                <div class="dev-numberbox" name="longitude" style="width: 239px; height: 24px; margin-top: 6px;" opt='{"Required":true,"Precision":14,"Min":0,"Max":180,"HeaderCSS":{"padding":"0px","width":"85px"},"IsOverShow":true,"Padding":"0px 5px","Title":"<div class=\"Title\"><span>经度</span></div>"}'></div>
            </div>
            <div class="Cell" style="width: 209px;">
                <div class="dev-numberbox" name="latitude" style="width: 209px; height: 24px; margin-top: 6px;" maxlength='36' opt='{"Required":true,"Precision":14,"Min":0,"Max":90,"HeaderCSS":{"padding":"0px","width":"85px"},"IsOverShow":true,"Padding":"0px 5px","Title":"<div class=\"Title\"><span>纬度</span></div>"}'></div>
            </div>
            <div class="PositionBtn"></div>

        </div>
        <div class="Row">
            <div class="Cell">
                <div class="dev-textbox" name="use" style="width: 488px; height: 24px; margin-top: 6px;" maxlength='256' opt='{"MaxLength":50, "TipInfo":"50位以内","HeaderCSS":{"padding":"0px","width":"85px"},"IsOverShow":true,"Padding":"0px 5px","Title":"<div class=\"Title\"><span>车辆用途</span></div>"}'></div>
            </div>
        </div>
        <div class="Row" style="height: 98px; width: 100%; border-bottom: 1px solid #ddd;">
            <div class="Cell" style="height: 89px; width: 488px;">
                <div class="dev-textbox" name="remark" style="z-index: 2; width: 488px; height: 85px; margin-top: 6px;" maxlength='120' opt='{"MaxLength":120, "TipInfo":"120位以内","Type":"multi-text","HeaderCSS":{"padding":"0px","width":"85px"},"IsOverShow":true,"Padding":"5px","Title":"<div class=\"Title\">备注</div>"}'></div>
            </div>
        </div>
        <div id="errorlog" style="width: 250px; display: inline-block; float: left; margin-top: 20px; margin-left: 20px; color: red"></div>
        <div class="Submit">
            <div class="Button" tag="save">
                <span style="line-height: 26px; color: #fcfcfc;">保&nbsp;&nbsp;存</span>
            </div>
            <div class="Button" tag="cancel">
                <span style="line-height: 26px; color: #fcfcfc;">取&nbsp;&nbsp;消</span>
            </div>
        </div>
    </div>
    <div id="toolbarmod" style="height: 35px; background-color: #fcfcfc">
        <div style="margin-top: 5px;">
            <div id="modlistType" class="dev-combobox" style="width: 95px; float: left; margin-left: 8px; display: inline-block;" opt='{ "PopupHeight":"auto","TextField":"data","ValueField":"id","TipInfo":"选择农机类型"}'></div>
            <div id="macnumSearch" class="dev-textbox" style="width: 95px; float: left; margin-left: 8px; display: inline-block;" opt='{"TipInfo":"请输入农机型号"}'></div>
            <div style="width: 76px; height: 30px; display: inline-block; margin-left: 116px;">
                <div id="macsearch" style="cursor: pointer; height: 24px; width: 35px; display: inline-block; background-color: #03afd9; float: left; color: #fff; line-height: 24px; text-align: center;">查询</div>
                <div id="macreset" style="cursor: pointer; height: 24px; width: 35px; display: inline-block; background-color: #03afd9; margin-left: 6px; color: #fff; line-height: 24px; text-align: center;">重置</div>
            </div>
        </div>
    </div>
</body>
</html>
