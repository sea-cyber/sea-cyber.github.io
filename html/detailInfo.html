<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <title>详细信息</title>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
    <link rel="stylesheet" href="../theme/default/easyui.css" />
    <link rel="stylesheet" type="text/css" href="../theme/icon.css" />
    <link rel="stylesheet" type="text/css" href="../css/app.css" />
    <link rel="stylesheet" type="text/css" href="../css/main.css" />
    <link rel="stylesheet" type="text/css" href="../css/icon.css" />
    <script type="text/javascript" src="../js/jquery.min.js"></script>
    <script type="text/javascript" src="../js/jquery.easyui.min.js"></script>
    <script type="text/javascript" src="../js/easyui-lang-zh_CN.js"></script>
    <script type="text/javascript" src="../js/linq.min.js"></script>
    <script type="text/javascript" src="../js/data.util.js"></script>
    <script type="text/javascript" src="../js/jquery.dev.control.js"></script>
    <script type="text/javascript" src="../js/dev.ui.js"></script>
    <script type="text/javascript">
        var Dev = window.top.window.dev;
        var parent, param;
        var type, url, primarykey, keyvalue;
        var filedConfig = Dev.App.Config.Extend.DetailFields.FieldInfo;
        var fileds;
        var box;
        function WidgetCommunication(s) {//部件通讯
            parent = s.parent;
            param = s.param;
            type = param.Type;
            url = param.ServerUrl;
            primarykey = param.PrimaryKey;
            keyvalue = param.KeyValue;
            if (Dev.IsNull(type) || Dev.IsNull(url) || Dev.IsNull(primarykey) || Dev.IsNull(keyvalue)) return;
            Dev.App.RightPanel.SetVisible(true);
            Dev.App.RightPanel.SetWidth(240);
            Dev.App.RightPanel.Header.css({ "background": "#14cdad", "color": "#fcfcfc", "font-weight": "bold", "border-left": "1px solid #36424E" });
            Dev.App.RightPanel.SetIconCls("machine-carmanage");
            Dev.App.RightPanel.SetTitle("详细信息");
            if (Dev.IsNull(filedConfig)) return;
            if (Dev.IsNull(filedConfig.length)) fileds = [Dev.ObjClone(filedConfig)];
            else fileds = filedConfig.clone();
          //  Enumerable.From(fields).Where('s=>s.IsPopupVisible=="true" && s.BelongData.indexOf("' + tablename + '")>=0').ToArray();
            fileds = Enumerable.From(fileds).Where('s=>s.BelongData.indexOf("' + type + '")>=0').ToArray();
            if (Dev.IsNull(fileds) || fileds.length == 0) return;
            box = new Dev.Box({ HasBorder: false });
            box.Target.css({
                width: Dev.App.RightPanel.Width - 1,
                height: Dev.App.RightPanel.Content.height(),
                "border-left": "1px solid #36424E"
            });
            box.Target.appendTo(document.body);
            var div = $('<div id="filedsContent" class="DetailInfo"></div>');
            box.SetContent(div);
            //查询详细信息
            $.ajax({
                url: url,
                type: "POST",
                contentType: 'application/json',
                dataType: 'json',
                data: "\"" + primarykey + "\"='" + keyvalue + "'",
                success: function (response) {
                    if (response.statusCode != 200 || Dev.IsNull(response.data) || response.data.length == 0) return;
                    initInfo(response.data[0]);
                },
                error: function (e) {
                    //dialog.Alert(msg.netout, "error");
                }
            });
            $(window).resize(function () { resize(); });
        }
        
        function resize() {
            if (Dev.IsNull(box)) return;
            var width = $(window).width();
            box.SetSize({ Width: width-1, Height: $(window).height() });
            $(".DetailInfo .Value").css({ width: (width - 106) + "px" });
            $(".DetailInfo .Value1").css({ width: (width - 106) + "px" });
        }
        function initInfo(data) {
            for (var i = 0; i < fileds.length; i++) {
                var top = i * 35 + "px;", style = "top:" + top;
                var titleCls = (i % 2 == 0) ? "Title" : "Title1";
                var valueCls = (i % 2 == 0) ? "Value" : "Value1";
                var style2 = "";
                var byname = fileds[i].ByName;
                if (fileds[i].ByName.length > 6) {
                    byname = byname.substring(0, 4) + "<br/>" + byname.substring(4, byname.length);
                    style += "line-height:17.5px;";
                }
                if (fileds[i].ByName == "备注") {
                    style2 += "line-height:17.5px;height:180px;";
                    style += "line-height:17.5px;height:180px;";
                }
                $('<div class="' + titleCls + '" style="' + style + '">' + byname + '</div>').appendTo($('#filedsContent'));
                if (fileds[i].ValueType == "bool") data[fileds[i].Name.toLowerCase()] = data[fileds[i].Name.toLowerCase()] > 0 ? "是" : "否";
                else if (fileds[i].ValueType == "number") data[fileds[i].Name.toLowerCase()] = data[fileds[i].Name.toLowerCase()] > 0 ? data[fileds[i].Name.toLowerCase()] : "-";
                else if (fileds[i].ValueType == "datetime") data[fileds[i].Name.toLowerCase()] = Dev.IsNull(data[fileds[i].Name.toLowerCase()]) ? "-" : Dev.GetDateString(new Date(parseFloat(data[fileds[i].Name.toLowerCase()])));
                var value = Dev.IsNull(data[fileds[i].Name.toLowerCase()]) ? "-" : data[fileds[i].Name.toLowerCase()];
                $('<div class="' + valueCls + '" style="top:' + top + ';' + style2 + '">' + value + '</div>').appendTo($('#filedsContent'));
            }
            var width = ($(window).width() - 106) + "px";
            $(".DetailInfo .Value").css("width", width);
            $(".DetailInfo .Value1").css("width", width);
        }
    </script>
</head>
<body style="height:100%;width:100%;">
</body>
</html>
